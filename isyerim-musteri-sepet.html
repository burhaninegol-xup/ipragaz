<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Sepet - İpragaz</title>
	<link rel="shortcut icon" type="image/x-icon" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: #fff;
			color: #333;
			min-height: 100vh;
			display: flex;
			flex-direction: column;
		}

		a {
			text-decoration: none;
			color: inherit;
		}

		/* Stepper */
		.stepper {
			display: flex;
			align-items: center;
			gap: 0;
		}

		.step {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.step-number {
			width: 28px;
			height: 28px;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 13px;
			font-weight: 600;
		}

		.step-number.active {
			background: #e31e24;
			color: #fff;
		}

		.step-number.completed {
			background: #e31e24;
			color: #fff;
		}

		.step-number.inactive {
			border: 1px solid #ccc;
			color: #999;
			background: #fff;
		}

		.step-label {
			font-size: 14px;
			font-weight: 500;
		}

		.step-label.active {
			color: #333;
		}

		.step-label.inactive {
			color: #999;
		}

		.step-line {
			width: 80px;
			height: 1px;
			background: #ddd;
			margin: 0 15px;
		}

		/* Main Layout */
		.main-container {
			max-width: 1400px;
			margin: 0 auto;
			padding: 40px 60px;
			display: flex;
			gap: 80px;
			flex: 1;
			width: 100%;
		}

		/* Cart Content */
		.cart-content {
			flex: 2;
		}

		.cart-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 20px;
		}

		.cart-title-wrapper {
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.back-arrow {
			color: #333;
			cursor: pointer;
			display: flex;
			align-items: center;
		}

		.back-arrow svg {
			width: 20px;
			height: 20px;
		}

		.cart-title {
			font-size: 18px;
			font-weight: 600;
			color: #333;
		}

		.cart-clear {
			color: #e31e24;
			cursor: pointer;
			display: flex;
			align-items: center;
		}

		.cart-clear svg {
			width: 20px;
			height: 20px;
		}

		/* Cart Item */
		.cart-item {
			display: flex;
			align-items: center;
			gap: 20px;
			padding: 20px 0;
			border-top: 1px solid #eee;
			border-bottom: 1px solid #eee;
		}

		.cart-item-image {
			width: 100px;
			height: 120px;
			border: 1px solid #eee;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 10px;
		}

		.cart-item-image img {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
		}

		.cart-item-details {
			flex: 1;
		}

		.cart-item-name {
			font-size: 15px;
			font-weight: 500;
			color: #333;
			margin-bottom: 30px;
		}

		.quantity-control {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.quantity-btn {
			width: 28px;
			height: 28px;
			border-radius: 50%;
			border: none;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: pointer;
			transition: all 0.2s;
		}

		.quantity-btn.delete {
			background: transparent;
			color: #999;
		}

		.quantity-btn.delete:hover {
			color: #e31e24;
		}

		.quantity-btn.delete svg {
			width: 18px;
			height: 18px;
		}

		.quantity-btn.add {
			background: #e31e24;
			color: #fff;
		}

		.quantity-btn.add:hover {
			background: #c41a1f;
		}

		.quantity-btn.add svg {
			width: 16px;
			height: 16px;
		}

		.quantity-value {
			font-size: 14px;
			color: #333;
		}

		.quantity-input {
			width: 50px;
			text-align: center;
			border: 1px solid #ddd;
			border-radius: 4px;
			padding: 4px 8px;
			font-size: 14px;
			font-family: inherit;
		}

		.quantity-input:focus {
			outline: none;
			border-color: #e31e24;
		}

		.quantity-label {
			font-size: 14px;
			color: #333;
			margin-left: 4px;
		}

		/* Sidebar - Order Summary */
		.sidebar {
			width: 380px;
			flex-shrink: 0;
		}

		.order-summary {
			background: #fff;
		}

		.order-summary-title {
			font-size: 20px;
			font-weight: 600;
			color: #333;
			margin-bottom: 5px;
		}

		.order-summary-count {
			font-size: 13px;
			color: #666;
			margin-bottom: 20px;
		}

		.order-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-bottom: 10px;
		}

		.order-row-label {
			font-size: 14px;
			color: #333;
		}

		.order-row-value {
			font-size: 14px;
			font-weight: 600;
			color: #333;
		}

		.order-row-value span {
			font-weight: 400;
			margin-left: 5px;
		}

		/* Fiyat + Puan Görünümü */
		.order-row-values {
			display: flex;
			flex-direction: column;
			align-items: flex-end;
			gap: 4px;
		}

		.price-value {
			font-size: 15px;
			font-weight: 600;
			color: #333;
			line-height: 1.3;
		}

		.price-value-large {
			font-size: 18px;
		}

		.points-value {
			font-size: 12px;
			font-weight: 400;
			color: #888;
			line-height: 1.3;
		}

		/* Order Divider */
		.order-divider {
			height: 1px;
			background: #eee;
			margin: 15px 0;
		}

		.total-row .order-row-label {
			font-weight: 600;
		}

		/* Ürün birim fiyatı */
		.cart-item-unit-price {
			font-size: 13px;
			color: #666;
			margin-bottom: 12px;
			display: flex;
			gap: 12px;
		}

		.cart-item-unit-price .unit-points {
			color: #888;
			font-size: 12px;
		}

		/* Price Labels */
		.price-label {
			font-size: 10px;
			padding: 2px 6px;
			border-radius: 4px;
			margin-left: 5px;
			font-weight: 500;
		}
		.price-label.size-ozel {
			background: #e8f5e9;
			color: #2e7d32;
		}
		.price-label.bayi-ozel {
			background: #e3f2fd;
			color: #1565c0;
		}
		.price-label.perakende {
			background: #f5f5f5;
			color: #666;
		}

		/* Ürün toplam fiyatı (sağda) */
		.cart-item-total {
			text-align: right;
			min-width: 120px;
			flex-shrink: 0;
		}

		.item-total-price {
			font-size: 16px;
			font-weight: 600;
			color: #333;
		}

		.item-total-points {
			font-size: 12px;
			color: #888;
			margin-top: 4px;
		}

		/* Campaign Section */
		.campaign-section {
			margin-top: 25px;
			border: 1px solid #eee;
			border-radius: 8px;
			overflow: hidden;
		}

		.campaign-header {
			display: flex;
			align-items: center;
			justify-content: space-between;
			padding: 15px;
			background: #f9f9f9;
			cursor: pointer;
		}

		.campaign-header-title {
			font-size: 14px;
			font-weight: 500;
			color: #333;
		}

		.campaign-header svg {
			width: 18px;
			height: 18px;
			color: #666;
			transition: transform 0.3s;
		}

		.campaign-header.open svg {
			transform: rotate(180deg);
		}

		.campaign-content {
			padding: 15px;
			display: none;
		}

		.campaign-content.open {
			display: block;
		}

		.campaign-label {
			font-size: 13px;
			color: #666;
			margin-bottom: 12px;
		}

		.campaign-option {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 12px;
			border: 1px solid #eee;
			border-radius: 8px;
		}

		.campaign-option input[type="radio"] {
			width: 18px;
			height: 18px;
			accent-color: #e31e24;
			cursor: pointer;
		}

		.campaign-option-icon {
			width: 40px;
			height: 40px;
			background: #fff5f5;
			border-radius: 8px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.campaign-option-icon svg {
			width: 24px;
			height: 24px;
			color: #e31e24;
		}

		.campaign-option-details {
			flex: 1;
		}

		.campaign-option-name {
			font-size: 14px;
			font-weight: 500;
			color: #333;
		}

		.campaign-option-desc {
			font-size: 12px;
			color: #888;
		}

		.campaign-option-link {
			font-size: 13px;
			color: #e31e24;
			font-weight: 500;
		}

		.campaign-option-link:hover {
			text-decoration: underline;
		}

		/* Proceed Button */
		.btn-proceed {
			width: 100%;
			padding: 16px 30px;
			background: #e31e24;
			color: #fff;
			border: none;
			border-radius: 30px;
			font-size: 15px;
			font-weight: 600;
			font-family: inherit;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			margin-top: 25px;
			transition: background 0.2s, transform 0.2s;
		}

		.btn-proceed:hover {
			background: #c41a1f;
			transform: translateY(-1px);
		}

		.btn-proceed:active {
			transform: translateY(0);
		}

		.btn-proceed svg {
			width: 18px;
			height: 18px;
		}

		/* Responsive */
		@media (max-width: 900px) {
			.stepper-container {
				padding: 15px 20px !important;
			}

			.stepper {
				flex-wrap: wrap;
				justify-content: center;
			}

			.step-line {
				width: 30px;
				margin: 0 10px;
			}

			.main-container {
				flex-direction: column;
				padding: 20px;
				gap: 30px;
			}

			.sidebar {
				width: 100%;
			}
		}

		@media (max-width: 600px) {
			.step-label {
				display: none;
			}

			.step-line {
				width: 20px;
			}

			.cart-item {
				flex-direction: column;
				align-items: flex-start;
			}

			.cart-item-image {
				width: 80px;
				height: 100px;
			}

			.price-value {
				font-size: 16px;
			}

			.price-value-large {
				font-size: 20px;
			}

			.points-value {
				font-size: 13px;
			}

			/* Ürün toplam fiyatı mobilde */
			.cart-item-total {
				width: 100%;
				text-align: left;
				margin-top: 10px;
				padding-top: 10px;
				border-top: 1px dashed #eee;
			}
		}
	</style>
</head>
<body>
	<!-- Top Bar (Component) -->
	<div id="isyerim-top-bar"></div>

	<!-- Header (Component) -->
	<div id="isyerim-header"></div>

	<!-- Stepper -->
	<div class="stepper-container" style="background: #fff; padding: 20px 60px; border-bottom: 1px solid #eee; display: flex; justify-content: center;">
		<div class="stepper">
			<div class="step">
				<span class="step-number completed">1</span>
				<span class="step-label active">Siparis Detayi</span>
			</div>
			<div class="step-line"></div>
			<div class="step">
				<span class="step-number active">2</span>
				<span class="step-label active">Sepet</span>
			</div>
			<div class="step-line"></div>
			<div class="step">
				<span class="step-number inactive">3</span>
				<span class="step-label inactive">Teslimat ve Odeme</span>
			</div>
		</div>
	</div>

	<!-- Main Container -->
	<div class="main-container">
		<!-- Cart Content -->
		<div class="cart-content">
			<!-- Header -->
			<div class="cart-header">
				<div class="cart-title-wrapper">
					<a href="isyerim-musteri-anasayfa.html" class="back-arrow">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<path d="M19 12H5M12 19l-7-7 7-7"/>
						</svg>
					</a>
					<h1 class="cart-title">Sepetim <span id="cartCount">(1 Ürün)</span></h1>
				</div>
				<button class="cart-clear" id="clearCart">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<polyline points="3 6 5 6 21 6"/>
						<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
					</svg>
				</button>
			</div>

			<!-- Cart Items -->
			<div class="cart-items" id="cartItems">
				<!-- Dinamik olarak doldurulacak -->
			</div>

			<!-- Boş Sepet Mesajı -->
			<div class="empty-cart" id="emptyCart" style="display: none; text-align: center; padding: 60px 20px;">
				<svg viewBox="0 0 24 24" fill="none" stroke="#ccc" stroke-width="1.5" style="width: 80px; height: 80px; margin-bottom: 20px;">
					<circle cx="9" cy="21" r="1"/>
					<circle cx="20" cy="21" r="1"/>
					<path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/>
				</svg>
				<h3 style="color: #666; font-size: 18px; margin-bottom: 10px;">Sepetiniz Boş</h3>
				<p style="color: #999; font-size: 14px; margin-bottom: 20px;">Ürün eklemek için anasayfaya gidin.</p>
				<a href="isyerim-musteri-anasayfa.html" style="display: inline-block; padding: 12px 30px; background: #e31e24; color: #fff; border-radius: 25px; font-weight: 500; text-decoration: none;">Alışverişe Başla</a>
			</div>
		</div>

		<!-- Sidebar - Order Summary -->
		<aside class="sidebar">
			<div class="order-summary">
				<h2 class="order-summary-title">Sipariş Özeti</h2>
				<div class="order-summary-count" id="orderCount">(1 Ürün)</div>

				<div class="order-row total-row">
					<span class="order-row-label">Toplam Tutar</span>
					<div class="order-row-values">
						<span class="price-value price-value-large" id="orderTotal">₺0,00</span>
						<span class="points-value" id="orderTotalPoints">★ 0 Puan</span>
					</div>
				</div>

				<!-- Campaign Section -->
				<div class="campaign-section">
					<div class="campaign-header open" id="campaignHeader">
						<span class="campaign-header-title">Sepete Uygulanan Kampanya</span>
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
							<polyline points="6 9 12 15 18 9"/>
						</svg>
					</div>
					<div class="campaign-content open" id="campaignContent">
						<div class="campaign-label">Kampanyalar</div>
						<div class="campaign-option">
							<input type="radio" name="campaign" id="campaign1" checked>
							<div class="campaign-option-icon">
								<svg viewBox="0 0 24 24" fill="currentColor">
									<path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
								</svg>
							</div>
							<div class="campaign-option-details">
								<div class="campaign-option-name">Kilo Kilo Puan Kampanyası</div>
								<div class="campaign-option-desc">Kilo Kilo Puan Kampanyası</div>
							</div>
							<a href="#" class="campaign-option-link">Detaylar</a>
						</div>
					</div>
				</div>

				<!-- Proceed Button -->
				<button class="btn-proceed" id="proceedBtn">
					Siparişe Devam Et
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M5 12h14M12 5l7 7-7 7"/>
					</svg>
				</button>
			</div>
		</aside>
	</div>

	<!-- Footer (Component) -->
	<div id="isyerim-footer"></div>

	<!-- Component Loader -->
	<script src="./js/component-loader.js"></script>

	<!-- Supabase -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/cart-service.js?v=4"></script>
	<script src="./js/services/orders-service.js"></script>
	<script src="./js/services/dealers-service.js"></script>
	<script src="./js/services/branches-service.js"></script>
	<script src="./js/services/customers-service.js"></script>
	<script>
		// Campaign toggle
		document.getElementById('campaignHeader').addEventListener('click', function() {
			this.classList.toggle('open');
			document.getElementById('campaignContent').classList.toggle('open');
		});

		// Fiyat formatlama
		function formatPrice(price) {
			return '₺' + parseFloat(price || 0).toLocaleString('tr-TR', {
				minimumFractionDigits: 2,
				maximumFractionDigits: 2
			});
		}

		// Ürün resmi getir
		function getProductImage(item) {
			if (item.image_url) return item.image_url;
			// Fallback resimler
			var defaultImage = './İpragaz Bayi_files/IPR-BAYI-12-kg-ipr-uzun.png';
			if (item.code) {
				if (item.code.includes('24')) return './İpragaz Bayi_files/IPR-BAYI-24kg-sanayi.png';
				if (item.code.includes('45')) return './İpragaz Bayi_files/IPR-BAYI-45kg-sanayi.png';
			}
			return defaultImage;
		}

		// Sepeti render et
		function renderCart() {
			var summary = CartService.getSummary();
			var cartItemsEl = document.getElementById('cartItems');
			var emptyCartEl = document.getElementById('emptyCart');
			var cartCountEl = document.getElementById('cartCount');
			var orderCountEl = document.getElementById('orderCount');

			if (summary.isEmpty) {
				cartItemsEl.style.display = 'none';
				emptyCartEl.style.display = 'block';
				cartCountEl.textContent = '(0 Ürün)';
				orderCountEl.textContent = '(0 Ürün)';
				document.getElementById('orderTotal').textContent = formatPrice(0);
				document.getElementById('orderTotalPoints').textContent = '★ 0 Puan';
				return;
			}

			cartItemsEl.style.display = 'block';
			emptyCartEl.style.display = 'none';

			cartCountEl.textContent = '(' + summary.itemCount + ' Ürün)';
			orderCountEl.textContent = '(' + summary.itemCount + ' Ürün)';

			// Toplam Tutar göster
			document.getElementById('orderTotal').textContent = formatPrice(summary.total);
			document.getElementById('orderTotalPoints').textContent = '★ ' + summary.totalPoints + ' Puan';

			// Ürünleri render et
			cartItemsEl.innerHTML = summary.items.map(function(item) {
				var itemTotal = parseFloat(item.price || 0) * item.quantity;
				var unitPoints = Math.floor(parseFloat(item.price) || 0);
				var itemTotalPoints = unitPoints * item.quantity;

				// Fiyat etiketi
				var priceLabelHtml = '';
				if (item.priceLabel) {
					var cssClass = item.priceType || 'perakende';
					priceLabelHtml = '<span class="price-label ' + cssClass + '">' + item.priceLabel + '</span>';
				}

				return '<div class="cart-item" data-product-id="' + item.id + '">' +
					'<div class="cart-item-image">' +
						'<img src="' + getProductImage(item) + '" alt="' + item.name + '">' +
					'</div>' +
					'<div class="cart-item-details">' +
						'<div class="cart-item-name">' + item.name + '</div>' +
						'<div class="cart-item-unit-price">' +
							'<span>Birim: ' + formatPrice(item.price) + priceLabelHtml + '</span>' +
							'<span class="unit-points">★ ' + unitPoints + ' Puan</span>' +
						'</div>' +
						'<div class="quantity-control">' +
							'<button class="quantity-btn delete" onclick="decreaseQuantity(\'' + item.id + '\')">' +
								'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">' +
									'<line x1="5" y1="12" x2="19" y2="12"/>' +
								'</svg>' +
							'</button>' +
							'<input type="text" class="quantity-input" value="' + item.quantity + '" onblur="handleQuantityChange(\'' + item.id + '\', this.value)" onkeypress="return isNumberKey(event)" inputmode="numeric" pattern="[0-9]*">' +
							'<span class="quantity-label">Adet</span>' +
							'<button class="quantity-btn add" onclick="increaseQuantity(\'' + item.id + '\')">' +
								'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">' +
									'<line x1="12" y1="5" x2="12" y2="19"/>' +
									'<line x1="5" y1="12" x2="19" y2="12"/>' +
								'</svg>' +
							'</button>' +
							'<button class="quantity-btn delete" onclick="removeItem(\'' + item.id + '\')" style="margin-left: 15px;">' +
								'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">' +
									'<polyline points="3 6 5 6 21 6"/>' +
									'<path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>' +
								'</svg>' +
							'</button>' +
						'</div>' +
					'</div>' +
					'<div class="cart-item-total">' +
						'<div class="item-total-price">' + formatPrice(itemTotal) + '</div>' +
						'<div class="item-total-points">★ ' + itemTotalPoints + ' Puan</div>' +
					'</div>' +
				'</div>';
			}).join('');
		}

		// Sadece sayısal giriş
		function isNumberKey(evt) {
			var charCode = (evt.which) ? evt.which : evt.keyCode;
			if (charCode > 31 && (charCode < 48 || charCode > 57)) {
				return false;
			}
			return true;
		}

		// Blur olduğunda adet güncelle
		async function handleQuantityChange(productId, value) {
			var quantity = parseInt(value, 10);
			if (isNaN(quantity) || quantity < 1) {
				// Geçersiz değer, sepeti yeniden render et (eski değeri geri getir)
				renderCart();
				return;
			}
			await CartService.updateQuantity(productId, quantity);
			renderCart();
		}

		async function increaseQuantity(productId) {
			await CartService.incrementQuantity(productId);
			renderCart();
		}

		async function decreaseQuantity(productId) {
			await CartService.decrementQuantity(productId);
			renderCart();
		}

		async function removeItem(productId) {
			if (confirm('Ürünü sepetten kaldırmak istediğinize emin misiniz?')) {
				await CartService.removeItem(productId);
				renderCart();
			}
		}

		async function clearCart() {
			if (confirm('Sepeti temizlemek istediğinize emin misiniz?')) {
				await CartService.clearCart();
				renderCart();
			}
		}

		// Sayfa yüklendiğinde sepeti render et
		renderCart();

		// Sepet güncellendiğinde yeniden render et
		window.addEventListener('cartUpdated', function() {
			renderCart();
		});

		// Sepeti temizle butonu
		document.getElementById('clearCart').addEventListener('click', clearCart);

		// Siparişe devam et
		document.getElementById('proceedBtn').addEventListener('click', async function() {
			if (CartService.isEmpty()) {
				alert('Sepetiniz boş. Lütfen ürün ekleyin.');
				return;
			}

			// Teslimat sayfasına yönlendir veya direkt sipariş oluştur
			// Şimdilik teslimat sayfası yoksa direkt sipariş oluşturalım
			var customerId = sessionStorage.getItem('customer_id');
			var dealerId = sessionStorage.getItem('dealer_id');

			if (!customerId || !dealerId) {
				// Bayi ID'sini otomatik al
				try {
					const { data: dealers } = await DealersService.getAll();
					if (dealers && dealers.length > 0) {
						dealerId = dealers[0].id;
						sessionStorage.setItem('dealer_id', dealerId);
					}
				} catch (e) {
					console.error('Bayi bilgisi alınamadı:', e);
				}

				// Demo müşteri ID kullan veya teslimat sayfasına yönlendir
				if (!customerId) {
					// Teslimat sayfasına yönlendir (orada müşteri bilgisi girilecek)
					window.location.href = 'isyerim-musteri-teslimat.html';
					return;
				}
			}

			// Sipariş oluştur
			this.disabled = true;
			this.innerHTML = 'Sipariş oluşturuluyor...';

			try {
				const result = await CartService.checkout(customerId, dealerId, {
					paymentMethod: 'cash',
					notes: 'Web sipariş'
				});

				if (result.error) {
					alert('Sipariş oluşturulamadı: ' + result.error);
					this.disabled = false;
					this.innerHTML = 'Siparişe Devam Et <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
				} else {
					alert('Siparişiniz başarıyla oluşturuldu! Sipariş No: ' + (result.data.order_number || result.data.id));
					window.location.href = 'isyerim-musteri-anasayfa.html';
				}
			} catch (err) {
				console.error('Sipariş hatası:', err);
				alert('Sipariş oluşturulurken bir hata oluştu.');
				this.disabled = false;
				this.innerHTML = 'Siparişe Devam Et <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
			}
		});
	</script>
</body>
</html>
