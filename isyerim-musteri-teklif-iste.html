<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Teklif Iste - IsYerim Ipragaz</title>
	<link rel="shortcut icon" type="image/x-icon" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
	<link rel="stylesheet" href="css/isyerim-musteri-teklif-iste.css">
</head>
<body>
	<!-- Top Bar (Component) -->
	<div id="isyerim-top-bar"></div>

	<!-- Header (Component) -->
	<div id="isyerim-header"></div>

	<!-- Page Header -->
	<section class="page-header">
		<div class="container">
			<h1 class="page-title">Teklif Iste</h1>
			<p class="page-subtitle">Bayinizden fiyat teklifi talep edin</p>
		</div>
	</section>

	<!-- Main Content -->
	<main class="main-content">
		<div class="container content-with-chat">
			<!-- Status Banner (Aktif teklif varken gosterilecek) - Grid'in doğrudan child'ı -->
			<div class="offer-status-banner" id="offerStatusBanner" style="display: none;">
				<div class="status-icon" id="statusIcon"></div>
				<div class="status-content">
					<h4 class="status-title" id="statusTitle">Teklif Durumu</h4>
					<p class="status-message" id="statusMessage">Teklif talebiniz bayiye iletildi</p>
					<div class="status-dealer" id="statusDealer">
						<span>Bayi:</span> <strong id="statusDealerName">-</strong>
						<!-- Şube bilgisi inline -->
						<span class="dealer-branch-separator" id="branchSeparator" style="display: none;">|</span>
						<span class="branch-inline" id="branchInline" style="display: none;">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
							</svg>
							<span id="branchDisplayText">-</span>
						</span>
						<!-- Tooltip -->
						<div class="branch-tooltip" id="branchTooltip">
							<div class="branch-tooltip-header">Teklif Gecerli Subeler</div>
							<ul class="branch-tooltip-list" id="branchTooltipList"></ul>
						</div>
					</div>
				</div>
				<div class="offer-buttons">
					<button class="btn-accept-offer" id="btnAcceptOffer" onclick="acceptActiveOffer()" style="display: none;">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="20 6 9 17 4 12"/>
						</svg>
						Teklifi Kabul Et
					</button>
					<!-- Countdown Timer - butonun altına taşındı -->
					<div class="offer-countdown-container" id="offerCountdownContainer" style="display: none;">
						<span class="countdown-label">Onay Vermeniz için Kalan Süre:</span>
						<span class="countdown-timer" id="offerCountdownTimer">72:00:00</span>
					</div>
					<button class="btn-extend-branch-sm" id="btnExtendBranchInline" style="display: none;">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 5v14M5 12h14"/>
						</svg>
						Baska Subeye Uygula
					</button>
				</div>
			</div>

			<!-- Main Column -->
			<div class="main-column">
				<!-- Branch Extension Section (sadece accepted status'ta görünür) -->
				<div class="branch-extension-section" id="branchExtensionSection" style="display: none;">
					<div class="branch-extension-header">
						<svg viewBox="0 0 24 24"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/></svg>
						<span class="branch-extension-title">Teklifi Başka Şubeye Uygula</span>
					</div>
					<div class="current-branch-info" id="currentBranchInfo">
						Bu teklif <strong id="currentBranchName">-</strong> şubesi için geçerlidir.
					</div>
					<button class="btn-extend-branch" id="btnExtendBranch">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M12 5v14M5 12h14"/>
						</svg>
						Başka Şubeye Uygula
					</button>
				</div>

				<!-- Info Card -->
				<div class="info-card">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"/>
						<line x1="12" y1="16" x2="12" y2="12"/>
						<line x1="12" y1="8" x2="12.01" y2="8"/>
					</svg>
					<div class="info-card-content">
						<h4>Nasil Calisir?</h4>
						<p>Her urun icin aylik ortalama tuketim miktarinizi girin. Bayiniz bu bilgilere gore size ozel fiyat teklifi hazirlayacaktir.</p>
					</div>
				</div>

				<!-- Submit Section -->
				<div class="submit-section" id="submitSection" style="display: none;">
					<div class="dealer-info" id="dealerInfo" style="display: none;">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
							<polyline points="9 22 9 12 15 12 15 22"/>
						</svg>
						<span class="dealer-info-text">Teklif talep edilecek bayi: <strong id="dealerName">-</strong></span>
					</div>
					<div class="selected-count">
						Secilen urun: <strong id="selectedCount">0</strong>
					</div>
					<button class="btn-submit" id="submitBtn" disabled>
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
							<polyline points="14 2 14 8 20 8"/>
							<line x1="12" y1="18" x2="12" y2="12"/>
							<line x1="9" y1="15" x2="15" y2="15"/>
						</svg>
						Teklif Iste
					</button>
				</div>

				<!-- Products Grid -->
				<div class="products-grid" id="productsGrid">
					<!-- Urunler yukleniyor -->
					<div class="loading-placeholder" style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
						<p>Urunler yukleniyor...</p>
					</div>
				</div>

				<!-- Dealer Selection Section -->
				<div class="dealer-selection-section" id="dealerSelectionSection">
					<h3 class="dealer-selection-title">Teklif Isteyeceginiz Bayiyi Secin</h3>
					<div class="dealer-list" id="dealerList">
						<!-- Bayiler dinamik yuklenir -->
						<div style="grid-column: 1/-1; text-align: center; padding: 40px; color: #666;">
							<p>Bayiler yukleniyor...</p>
						</div>
					</div>
					<button class="dealer-continue-btn" id="dealerContinueBtn" disabled onclick="confirmPageDealerSelection()">
						Devam Et
					</button>
				</div>

				<!-- Teklif Iptal Link -->
				<div class="cancel-offer-link-wrapper" id="cancelOfferLinkWrapper" style="display: none;">
					<p class="cancel-offer-description">Mevcut teklifinizi iptal ederek yeniden teklif almak icin alttaki linke tiklayabilirsiniz</p>
					<a href="javascript:void(0)" class="cancel-offer-link" id="btnCancelOffer" onclick="cancelActiveOffer()">Teklifi Iptal Et</a>
				</div>

				<!-- Teklif Gecmisi Timeline -->
				<details class="offer-metadata" id="offer-metadata" style="display: none;">
					<summary>
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<polyline points="6 9 12 15 18 9"/>
						</svg>
						Teklif gecmisi
					</summary>
					<div class="metadata-timeline" id="metadata-timeline">
						<p class="timeline-empty">Yukleniyor...</p>
					</div>
				</details>
			</div>

			<!-- Chat Column -->
			<aside class="chat-column" id="chatColumn">
				<button class="chat-close-mobile" id="chatCloseMobile" onclick="closeChatMobile()">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"/>
						<line x1="6" y1="6" x2="18" y2="18"/>
					</svg>
				</button>
				<div class="chat-header">
					<h3>
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
						</svg>
						Mesajlar
					</h3>
					<span class="chat-badge" id="chatBadge" style="display: none;">0</span>
				</div>
				<div class="chat-messages" id="chatMessages">
					<div class="no-messages" id="noMessages">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
						</svg>
						<p>Henuz mesaj yok</p>
					</div>
				</div>
				<div class="chat-input-wrapper" id="chatInputWrapper">
					<textarea id="messageInput" placeholder="Mesajinizi yazin..." rows="1" onkeydown="handleMessageKeydown(event)"></textarea>
					<button class="btn-send-message" id="btnSendMessage" onclick="sendMessage()">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<line x1="22" y1="2" x2="11" y2="13"/>
							<polygon points="22 2 15 22 11 13 2 9 22 2"/>
						</svg>
					</button>
				</div>
				<div class="chat-disabled" id="chatDisabled" style="display: none;">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"/>
						<line x1="12" y1="8" x2="12" y2="12"/>
						<line x1="12" y1="16" x2="12.01" y2="16"/>
					</svg>
					<p>Mesajlasma icin aktif bir teklifiniz olmalidir</p>
				</div>
			</aside>
		</div>
	</main>

	<!-- Mobile Chat Toggle -->
	<button class="chat-toggle-mobile" id="chatToggleMobile" onclick="openChatMobile()">
		Mesajlar
		<span class="unread-badge" id="unreadBadgeMobile" style="display: none;">0</span>
	</button>

	<!-- Footer (Component) -->
	<div id="isyerim-footer"></div>

	<!-- Offer Summary Overlay -->
	<div class="offer-summary-overlay" id="offerSummaryOverlay">
		<div class="offer-summary-modal">
			<div class="offer-summary-header">
				<h3>Teklif Ozeti</h3>
				<button class="offer-summary-close" onclick="closeOfferSummary()">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"/>
						<line x1="6" y1="6" x2="18" y2="18"/>
					</svg>
				</button>
			</div>
			<div class="offer-summary-body">
				<div class="offer-summary-dealer">
					<div class="offer-summary-label">Teklif Istenen Bayi</div>
					<div class="offer-summary-dealer-name" id="summaryDealerName">-</div>
				</div>
				<div class="offer-summary-products">
					<div class="offer-summary-label">Secilen Urunler</div>
					<div class="offer-summary-products-list" id="summaryProductsList">
						<!-- Dinamik urun listesi -->
					</div>
					<div class="offer-summary-total">
						<span class="offer-summary-total-label">Toplam Urun</span>
						<span class="offer-summary-total-value" id="summaryTotalProducts">0 urun</span>
					</div>
				</div>
			</div>
			<div class="offer-summary-footer">
				<button class="btn-summary-cancel" onclick="closeOfferSummary()">Iptal</button>
				<button class="btn-summary-confirm" id="btnSummaryConfirm" onclick="confirmOfferRequest()">Onayla ve Gonder</button>
			</div>
		</div>
	</div>

	<!-- Success Modal -->
	<div class="modal-overlay" id="successModal">
		<div class="modal">
			<div class="modal-icon">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<polyline points="20 6 9 17 4 12"/>
				</svg>
			</div>
			<h3 class="modal-title">Teklif Talebiniz Alindi!</h3>
			<p class="modal-text">Teklif talebiniz bayinize iletildi. Bayiniz en kisa surede size ozel fiyat teklifi hazirlayacaktir.</p>
			<button class="modal-btn" onclick="window.location.href='isyerim-musteri-anasayfa.html'">Anasayfaya Don</button>
		</div>
	</div>

	<!-- Loading Overlay -->
	<div class="loading-overlay" id="loadingOverlay">
		<div class="loading-spinner"></div>
		<div class="loading-text" id="loadingText">Yukleniyor...</div>
	</div>

	<!-- Confirmation Modal -->
	<div class="modal-overlay" id="confirmationModal">
		<div class="modal modal-confirmation">
			<div class="modal-icon modal-icon-warning">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
					<line x1="12" y1="9" x2="12" y2="13"/>
					<line x1="12" y1="17" x2="12.01" y2="17"/>
				</svg>
			</div>
			<h3 class="modal-title" id="confirmationTitle">Teklifi Iptal Et</h3>
			<p class="modal-text modal-text-warning" id="confirmationMessage"></p>
			<div class="modal-actions">
				<button class="modal-btn modal-btn-cancel" onclick="closeConfirmationModal()">
					Vazgec
				</button>
				<button class="modal-btn modal-btn-danger" id="confirmationActionBtn">
					Evet, Iptal Et
				</button>
			</div>
		</div>
	</div>

	<!-- Security Questions Overlay -->
	<div class="overlay" id="securityQuestionsOverlay">
		<div class="overlay-content security-overlay-content">
			<div class="security-header">
				<h3>Guvenlik Beyanlari</h3>
				<div class="security-progress-bar">
					<div class="security-progress-fill" id="securityProgressFill"></div>
				</div>
			</div>
			<div class="security-questions-scroll">
				<div class="security-question-item">
					<p class="security-question-text"><span class="security-question-number">1</span>Kullanilan ve depolanan LPG tupleri farkli alanlardadir. Depolama ve kullanim alanlari zemin seviyesi altinda (bodrum v.s.) degildir. Bu ortamlarda havalandirma menfezi vardir.</p>
					<div class="security-radio-group">
						<label><input type="radio" name="secQ1" value="yes"> Evet</label>
						<label><input type="radio" name="secQ1" value="no"> Hayir</label>
					</div>
				</div>
				<div class="security-question-item">
					<p class="security-question-text"><span class="security-question-number">2</span>Kullandigimiz LPG Dedantoru, LPG hortumu, LPG boru tesisati ve diger ekipmanlar yasal standartlara uygundur ve LPG hortum uzunlugu 150 cm'den kisadir.</p>
					<div class="security-radio-group">
						<label><input type="radio" name="secQ2" value="yes"> Evet</label>
						<label><input type="radio" name="secQ2" value="no"> Hayir</label>
					</div>
				</div>
				<div class="security-question-item">
					<p class="security-question-text"><span class="security-question-number">3</span>LPG tuplerinin depolanacagi ve kullanilacagi alanlara 1 m den daha az mesafede gaz kaçaklarinin toplanarak tehlikeli olabilecegi yerler bulunmamaktadir.</p>
					<div class="security-radio-group">
						<label><input type="radio" name="secQ3" value="yes"> Evet</label>
						<label><input type="radio" name="secQ3" value="no"> Hayir</label>
					</div>
				</div>
				<div class="security-question-item">
					<p class="security-question-text"><span class="security-question-number">4</span>LPG Tuplerinin depolanacagi veya kullanilacagi alanlara 3 m den daha az mesafede elektrikli cihaz, yanici ve/veya kolay tutusabilen madde bulunmamaktadir.</p>
					<div class="security-radio-group">
						<label><input type="radio" name="secQ4" value="yes"> Evet</label>
						<label><input type="radio" name="secQ4" value="no"> Hayir</label>
					</div>
				</div>
			</div>
			<div class="security-checkbox-container">
				<input type="checkbox" id="securityAcceptCheckbox">
				<label for="securityAcceptCheckbox">Yukaridaki beyanlarimin dogrulugunu kabul ederim.</label>
			</div>
			<button class="btn-submit" id="securitySubmitBtn" onclick="submitSecurityAnswers()">Devam Et</button>
		</div>
	</div>

	<!-- Security Error Overlay -->
	<div class="overlay" id="securityErrorOverlay">
		<div class="overlay-content error-modal">
			<div class="error-icon">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<circle cx="12" cy="12" r="10"/>
					<line x1="12" y1="8" x2="12" y2="12"/>
					<line x1="12" y1="16" x2="12.01" y2="16"/>
				</svg>
			</div>
			<p class="error-message">Uyelik isleminize devam edemezsiniz. <span class="error-phone">444 47 72</span> numarali cagri merkezini arayabilirsiniz.</p>
			<button class="btn-close-overlay" onclick="closeSecurityError()">Tamam</button>
		</div>
	</div>

	<!-- Branch Select Overlay -->
	<div class="branch-select-overlay" id="branchSelectOverlay">
		<div class="branch-select-modal">
			<div class="branch-select-header">
				<h3>Şube Seçin</h3>
				<button class="branch-modal-close" id="branchModalClose">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"/>
						<line x1="6" y1="6" x2="18" y2="18"/>
					</svg>
				</button>
			</div>
			<p class="branch-select-description">Teklifin uygulanmasını istediğiniz şubeyi seçin. Bayi onayladıktan sonra seçilen şube için de aynı fiyatlar geçerli olacaktır.</p>
			<div class="branch-list" id="branchList">
				<div class="no-branches-message">Şubeler yükleniyor...</div>
			</div>
			<div class="branch-modal-actions">
				<button class="btn-modal-cancel" id="branchModalCancel">İptal</button>
				<button class="btn-modal-confirm" id="branchModalConfirm" disabled>Talep Gönder</button>
			</div>
		</div>
	</div>

	<!-- Supabase -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/products-service.js"></script>
	<script src="./js/services/customers-service.js"></script>
	<script src="./js/services/branches-service.js"></script>
	<script src="./js/services/offers-service.js"></script>
	<script src="./js/services/offer-logs-service.js"></script>
	<script src="./js/services/dealers-service.js"></script>
	<script src="./js/services/dealer-districts-service.js"></script>
	<script src="./js/services/messages-service.js"></script>
	<script src="./js/services/notifications-service.js"></script>
	<script src="./js/services/retail-prices-by-city-service.js"></script>
	<script src="./js/component-loader.js"></script>
	<script src="./js/isyerim-musteri-teklif-iste.js"></script>
</body>
</html>
