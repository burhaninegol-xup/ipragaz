<!DOCTYPE html>
<html lang="tr">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Güvenlik Beyanları - İpragaz</title>
	<link rel="shortcut icon" type="image/x-icon" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			min-height: 100vh;
			background-color: #e31e24;
			display: flex;
			align-items: center;
			justify-content: center;
			position: relative;
			overflow: hidden;
		}

		/* B Pattern Background */
		.bg-pattern {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			overflow: hidden;
			pointer-events: none;
		}

		.bg-pattern::before {
			content: 'B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B B';
			position: absolute;
			top: -50px;
			left: -50px;
			width: calc(100% + 100px);
			height: calc(100% + 100px);
			font-size: 80px;
			font-weight: 700;
			color: rgba(255, 255, 255, 0.08);
			word-spacing: 30px;
			line-height: 1.2;
			letter-spacing: 20px;
			word-break: break-all;
		}

		/* Login Card */
		.login-container {
			position: relative;
			z-index: 1;
			width: 100%;
			max-width: 480px;
			padding: 20px;
		}

		.login-card {
			background: #fff;
			border-radius: 12px;
			padding: 35px 30px;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
		}

		/* Logo */
		.logo {
			text-align: center;
			margin-bottom: 25px;
		}

		.logo svg {
			width: 140px;
			height: auto;
		}

		/* Progress Header */
		.progress-header {
			margin-bottom: 20px;
		}

		.progress-title {
			font-size: 18px;
			font-weight: 600;
			color: #333;
			margin-bottom: 12px;
		}

		.progress-bar {
			width: 100%;
			height: 6px;
			background: #eee;
			border-radius: 3px;
			overflow: hidden;
		}

		.progress-fill {
			width: 0%;
			height: 100%;
			background: #e31e24;
			border-radius: 3px;
			transition: width 0.3s ease;
		}

		/* Questions Scroll Area */
		.questions-scroll {
			max-height: 340px;
			overflow-y: auto;
			margin-bottom: 20px;
			padding-right: 10px;
		}

		.questions-scroll::-webkit-scrollbar {
			width: 5px;
		}

		.questions-scroll::-webkit-scrollbar-track {
			background: #f1f1f1;
			border-radius: 3px;
		}

		.questions-scroll::-webkit-scrollbar-thumb {
			background: #ccc;
			border-radius: 3px;
		}

		.questions-scroll::-webkit-scrollbar-thumb:hover {
			background: #bbb;
		}

		/* Question Item */
		.question-item {
			padding: 15px 0;
			border-bottom: 1px solid #eee;
		}

		.question-item:last-child {
			border-bottom: none;
		}

		.question-number {
			display: inline-block;
			width: 24px;
			height: 24px;
			background: #e31e24;
			color: #fff;
			border-radius: 50%;
			text-align: center;
			line-height: 24px;
			font-size: 12px;
			font-weight: 600;
			margin-right: 8px;
			flex-shrink: 0;
		}

		.question-text {
			color: #555;
			font-size: 13px;
			line-height: 1.6;
			margin-bottom: 12px;
		}

		.radio-group {
			display: flex;
			gap: 20px;
			margin-left: 32px;
		}

		.radio-option {
			display: flex;
			align-items: center;
			gap: 6px;
			cursor: pointer;
		}

		.radio-option input[type="radio"] {
			width: 16px;
			height: 16px;
			accent-color: #e31e24;
			cursor: pointer;
		}

		.radio-option label {
			font-size: 13px;
			color: #333;
			cursor: pointer;
		}

		/* Checkbox */
		.checkbox-container {
			display: flex;
			align-items: flex-start;
			gap: 10px;
			margin-bottom: 20px;
			padding: 15px;
			background: #f9f9f9;
			border-radius: 8px;
		}

		.checkbox-container input[type="checkbox"] {
			width: 18px;
			height: 18px;
			accent-color: #e31e24;
			cursor: pointer;
			flex-shrink: 0;
			margin-top: 1px;
		}

		.checkbox-container label {
			font-size: 13px;
			color: #333;
			line-height: 1.5;
			cursor: pointer;
		}

		/* Submit Button */
		.btn-submit {
			width: 100%;
			padding: 14px 20px;
			background: #c41e24;
			border: none;
			border-radius: 25px;
			color: #fff;
			font-size: 15px;
			font-weight: 600;
			font-family: inherit;
			cursor: pointer;
			transition: background 0.2s, transform 0.2s;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
		}

		.btn-submit:hover {
			background: #a81a1f;
			transform: translateY(-1px);
		}

		.btn-submit:active {
			transform: translateY(0);
		}

		.btn-submit:disabled {
			background: #ccc;
			cursor: not-allowed;
			transform: none;
		}

		.btn-submit svg {
			width: 18px;
			height: 18px;
		}

		/* Error Overlay */
		.error-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.6);
			display: none;
			align-items: center;
			justify-content: center;
			z-index: 1000;
		}

		.error-overlay.active {
			display: flex;
		}

		.error-modal {
			background: #fff;
			border-radius: 16px;
			padding: 40px;
			max-width: 400px;
			width: 90%;
			text-align: center;
			box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
		}

		.error-icon {
			width: 60px;
			height: 60px;
			background: #fff5f5;
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			margin: 0 auto 20px;
		}

		.error-icon svg {
			width: 32px;
			height: 32px;
			color: #e31e24;
		}

		.error-message {
			font-size: 15px;
			color: #333;
			line-height: 1.6;
			margin-bottom: 25px;
		}

		.error-phone {
			font-weight: 700;
			color: #e31e24;
		}

		.btn-close-overlay {
			padding: 12px 40px;
			background: #e31e24;
			color: #fff;
			border: none;
			border-radius: 25px;
			font-size: 14px;
			font-weight: 600;
			font-family: inherit;
			cursor: pointer;
			transition: background 0.2s;
		}

		.btn-close-overlay:hover {
			background: #c41a1f;
		}

		/* Loading Spinner */
		.spinner {
			width: 18px;
			height: 18px;
			border: 2px solid #fff;
			border-top-color: transparent;
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		/* Responsive */
		@media (max-width: 480px) {
			.login-card {
				padding: 25px 20px;
			}

			.logo svg {
				width: 120px;
			}

			.progress-title {
				font-size: 16px;
			}

			.questions-scroll {
				max-height: 280px;
			}

			.question-text {
				font-size: 12px;
			}

			.radio-group {
				margin-left: 0;
				gap: 15px;
			}

			.bg-pattern::before {
				font-size: 50px;
			}
		}
	</style>
</head>
<body>
	<!-- Background Pattern -->
	<div class="bg-pattern"></div>

	<!-- Login Container -->
	<div class="login-container">
		<div class="login-card">
			<!-- Logo -->
			<div class="logo">
				<svg viewBox="0 0 200 50" xmlns="http://www.w3.org/2000/svg">
					<!-- Power icon -->
					<circle cx="25" cy="25" r="20" fill="none" stroke="#e31e24" stroke-width="3"/>
					<path d="M25 10 L25 25" stroke="#e31e24" stroke-width="3" stroke-linecap="round"/>
					<!-- iPRAGAZ text -->
					<text x="55" y="32" font-family="Poppins, sans-serif" font-size="24" font-weight="700" fill="#e31e24">iPRAGAZ</text>
				</svg>
			</div>

			<!-- Progress Header -->
			<div class="progress-header">
				<div class="progress-title">Güvenlik Beyanları</div>
				<div class="progress-bar">
					<div class="progress-fill" id="progressFill"></div>
				</div>
			</div>

			<!-- Questions Scroll Area -->
			<div class="questions-scroll">
				<!-- Question 1 -->
				<div class="question-item">
					<p class="question-text"><span class="question-number">1</span>Kullanılan ve depolanan LPG tüpleri farklı alanlardadır. Depolama ve kullanım alanları zemin seviyesi altında (bodrum v.s.) değildir. Bu ortamlarda havalandırma menfezi vardır.</p>
					<div class="radio-group">
						<div class="radio-option">
							<input type="radio" id="q1-yes" name="question1" value="yes">
							<label for="q1-yes">Evet</label>
						</div>
						<div class="radio-option">
							<input type="radio" id="q1-no" name="question1" value="no">
							<label for="q1-no">Hayır</label>
						</div>
					</div>
				</div>

				<!-- Question 2 -->
				<div class="question-item">
					<p class="question-text"><span class="question-number">2</span>Kullandığımız LPG Dedantörü, LPG hortumu, LPG boru tesisatı ve diğer ekipmanlar yasal standartlara uygundur ve LPG hortum uzunluğu 150 cm'den kısadır.</p>
					<div class="radio-group">
						<div class="radio-option">
							<input type="radio" id="q2-yes" name="question2" value="yes">
							<label for="q2-yes">Evet</label>
						</div>
						<div class="radio-option">
							<input type="radio" id="q2-no" name="question2" value="no">
							<label for="q2-no">Hayır</label>
						</div>
					</div>
				</div>

				<!-- Question 3 -->
				<div class="question-item">
					<p class="question-text"><span class="question-number">3</span>LPG tüplerinin depolanacağı ve kullanılacağı alanlara 1 m den daha az mesafede gaz kaçaklarının toplanarak tehlikeli olabileceği yerler (kuyu, rögar, bodrum penceresi, kömürlük girişi, havalandırma kanalı vb.) bulunmamaktadır.</p>
					<div class="radio-group">
						<div class="radio-option">
							<input type="radio" id="q3-yes" name="question3" value="yes">
							<label for="q3-yes">Evet</label>
						</div>
						<div class="radio-option">
							<input type="radio" id="q3-no" name="question3" value="no">
							<label for="q3-no">Hayır</label>
						</div>
					</div>
				</div>

				<!-- Question 4 -->
				<div class="question-item">
					<p class="question-text"><span class="question-number">4</span>LPG Tüplerinin depolanacağı veya kullanılacağı alanlara 3 m den daha az mesafede elektrikli cihaz (klima motoru/fan Motoru/Jeneratör vb.), yanıcı ve/veya kolay tutuşabilen madde (ot, talaş; yonga, paçavra, üstüpü, benzin, mazot vb.) bulunmamaktadır.</p>
					<div class="radio-group">
						<div class="radio-option">
							<input type="radio" id="q4-yes" name="question4" value="yes">
							<label for="q4-yes">Evet</label>
						</div>
						<div class="radio-option">
							<input type="radio" id="q4-no" name="question4" value="no">
							<label for="q4-no">Hayır</label>
						</div>
					</div>
				</div>
			</div>

			<!-- Checkbox -->
			<div class="checkbox-container">
				<input type="checkbox" id="accept-terms">
				<label for="accept-terms">Yukarıdaki beyanlarımın doğruluğunu kabul ederim.</label>
			</div>

			<!-- Submit Button -->
			<button class="btn-submit" id="submit-btn">
				Devam Et
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<path d="M5 12h14M12 5l7 7-7 7"/>
				</svg>
			</button>
		</div>
	</div>

	<!-- Error Overlay -->
	<div class="error-overlay" id="errorOverlay">
		<div class="error-modal">
			<div class="error-icon">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
					<circle cx="12" cy="12" r="10"/>
					<line x1="12" y1="8" x2="12" y2="12"/>
					<line x1="12" y1="16" x2="12.01" y2="16"/>
				</svg>
			</div>
			<p class="error-message">Üyelik işleminize devam edemezsiniz. <span class="error-phone">444 47 72</span> numaralı çağrı merkezini arayabilirsiniz.</p>
			<button class="btn-close-overlay" id="closeOverlay">Tamam</button>
		</div>
	</div>

	<!-- Supabase Client -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/customers-service.js"></script>

	<script>
		// Browser back engelleme
		window.history.pushState(null, null, window.location.href);
		window.addEventListener('popstate', function() {
			window.history.pushState(null, null, window.location.href);
		});

		// Customer ID kontrol
		var customerId = sessionStorage.getItem('isyerim_customer_id');
		if (!customerId) {
			// Customer ID yoksa login'e yönlendir
			window.location.href = 'isyerim-musteri-login.html';
		}

		// Progress bar güncelleme
		function updateProgress() {
			var questions = ['question1', 'question2', 'question3', 'question4'];
			var answered = 0;

			questions.forEach(function(q) {
				var selected = document.querySelector('input[name="' + q + '"]:checked');
				if (selected) answered++;
			});

			var progress = (answered / questions.length) * 100;
			document.getElementById('progressFill').style.width = progress + '%';
		}

		// Radio değişikliklerini dinle
		document.querySelectorAll('input[type="radio"]').forEach(function(radio) {
			radio.addEventListener('change', updateProgress);
		});

		// Form submit
		document.getElementById('submit-btn').addEventListener('click', async function() {
			var btn = this;
			var checkbox = document.getElementById('accept-terms');
			var allAnswered = true;
			var hasNoAnswer = false;
			var questions = ['question1', 'question2', 'question3', 'question4'];
			var answers = {};

			// Check if all questions are answered and if any is "no"
			questions.forEach(function(q, index) {
				var selected = document.querySelector('input[name="' + q + '"]:checked');
				if (!selected) {
					allAnswered = false;
				} else {
					answers['q' + (index + 1)] = selected.value === 'yes';
					if (selected.value === 'no') {
						hasNoAnswer = true;
					}
				}
			});

			// 1. Tüm soruların işaretli olup olmadığını kontrol et
			if (!allAnswered) {
				alert('Lütfen tüm soruları cevaplayınız.');
				return;
			}

			// 2. Beyanların doğruluğu checkbox kontrolü
			if (!checkbox.checked) {
				alert('Lütfen beyanlarınızın doğruluğunu kabul ediniz.');
				return;
			}

			// 3. Tüm cevapların EVET olduğunu kontrol et
			if (hasNoAnswer) {
				document.getElementById('errorOverlay').classList.add('active');
				return;
			}

			// Button loading state
			btn.disabled = true;
			btn.innerHTML = '<div class="spinner"></div> Kaydediliyor...';

			try {
				// Veritabanına kaydet
				var result = await CustomersService.updateSecurityAnswers(customerId, answers);

				if (result.error) {
					console.error('Güvenlik cevapları kaydedilemedi:', result.error);
					alert('Bir hata oluştu. Lütfen tekrar deneyiniz.');
					btn.disabled = false;
					btn.innerHTML = 'Devam Et <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
					return;
				}

				// Başarılı - anasayfaya yönlendir
				window.location.href = 'isyerim-musteri-anasayfa.html';

			} catch (error) {
				console.error('Hata:', error);
				alert('Bir hata oluştu. Lütfen tekrar deneyiniz.');
				btn.disabled = false;
				btn.innerHTML = 'Devam Et <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12h14M12 5l7 7-7 7"/></svg>';
			}
		});

		// Close overlay
		document.getElementById('closeOverlay').addEventListener('click', function() {
			document.getElementById('errorOverlay').classList.remove('active');
		});

		// Close overlay when clicking outside modal
		document.getElementById('errorOverlay').addEventListener('click', function(e) {
			if (e.target === this) {
				this.classList.remove('active');
			}
		});
	</script>
</body>
</html>
