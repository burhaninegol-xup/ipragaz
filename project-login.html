<!DOCTYPE html>
<html lang="tr">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Proje Girişi - İpragaz</title>
	<meta http-equiv="Content-Language" content="Turkish">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<link rel="shortcut icon" type="image/x-icon" media="all" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap">

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Poppins', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			background: linear-gradient(135deg, #002c77 0%, #001a4d 100%);
			min-height: 100vh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.login-container {
			width: 100%;
			max-width: 420px;
		}

		.login-card {
			background: #fff;
			border-radius: 20px;
			padding: 40px;
			box-shadow: 0 10px 40px rgba(0,0,0,0.3);
		}

		.login-header {
			text-align: center;
			margin-bottom: 35px;
		}

		.login-logo {
			margin-bottom: 20px;
		}

		.login-logo svg {
			width: 140px;
			height: auto;
		}

		.login-title {
			font-size: 24px;
			font-weight: 700;
			color: #1a1a2e;
			margin-bottom: 8px;
		}

		.login-subtitle {
			font-size: 14px;
			color: #666;
		}

		.form-group {
			margin-bottom: 20px;
		}

		.form-group label {
			display: block;
			font-size: 13px;
			font-weight: 500;
			color: #666;
			margin-bottom: 8px;
		}

		.form-group input {
			width: 100%;
			padding: 14px 16px;
			border: 1px solid #e0e0e0;
			border-radius: 10px;
			font-size: 15px;
			transition: border-color 0.2s, box-shadow 0.2s;
		}

		.form-group input:focus {
			outline: none;
			border-color: #002c77;
			box-shadow: 0 0 0 3px rgba(0,44,119,0.1);
		}

		.form-group input.error {
			border-color: #e53935;
			background: #fff5f5;
		}

		.error-message {
			display: none;
			align-items: center;
			gap: 8px;
			padding: 12px 16px;
			background: #ffebee;
			border: 1px solid #ffcdd2;
			border-radius: 10px;
			margin-bottom: 20px;
			color: #c62828;
			font-size: 13px;
		}

		.error-message.visible {
			display: flex;
		}

		.error-message svg {
			width: 18px;
			height: 18px;
			flex-shrink: 0;
		}

		.login-btn {
			width: 100%;
			padding: 16px;
			background: linear-gradient(135deg, #002c77 0%, #0056b3 100%);
			color: #fff;
			border: none;
			border-radius: 10px;
			font-size: 15px;
			font-weight: 600;
			cursor: pointer;
			transition: all 0.2s;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
		}

		.login-btn:hover {
			background: linear-gradient(135deg, #001a4d 0%, #003d80 100%);
			transform: translateY(-2px);
			box-shadow: 0 4px 15px rgba(0,44,119,0.3);
		}

		.login-btn:disabled {
			background: #ccc;
			cursor: not-allowed;
			transform: none;
			box-shadow: none;
		}

		.login-btn svg {
			width: 20px;
			height: 20px;
		}

		.login-btn .spinner {
			width: 20px;
			height: 20px;
			border: 2px solid #fff;
			border-top-color: transparent;
			border-radius: 50%;
			animation: spin 0.8s linear infinite;
			display: none;
		}

		.login-btn.loading .spinner {
			display: block;
		}

		.login-btn.loading .btn-text {
			display: none;
		}

		.login-btn.loading svg {
			display: none;
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		.login-footer {
			text-align: center;
			margin-top: 25px;
			padding-top: 20px;
			border-top: 1px solid #eee;
		}

		.login-footer p {
			font-size: 12px;
			color: #999;
		}

		/* Responsive */
		@media (max-width: 480px) {
			.login-card {
				padding: 30px 25px;
			}

			.login-title {
				font-size: 20px;
			}
		}
	</style>
</head>

<body>
	<div class="login-container">
		<div class="login-card">
			<div class="login-header">
				<div class="login-logo">
					<svg viewBox="0 0 200 50" xmlns="http://www.w3.org/2000/svg">
						<circle cx="25" cy="25" r="20" fill="none" stroke="#002c77" stroke-width="3"/>
						<path d="M25 10 L25 25" stroke="#002c77" stroke-width="3" stroke-linecap="round"/>
						<text x="55" y="32" font-family="Poppins, sans-serif" font-size="24" font-weight="700" fill="#002c77">iPRAGAZ</text>
					</svg>
				</div>
				<h1 class="login-title">Proje Girişi</h1>
				<p class="login-subtitle">Projeye erişmek için giriş yapın</p>
			</div>

			<div class="error-message" id="error-message">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
				</svg>
				<span id="error-text">Kullanıcı adı veya şifre hatalı</span>
			</div>

			<form id="login-form">
				<div class="form-group">
					<label for="username">Kullanıcı Adı</label>
					<input type="text" id="username" placeholder="Kullanıcı adınızı girin" required autocomplete="username">
				</div>

				<div class="form-group">
					<label for="password">Şifre</label>
					<input type="password" id="password" placeholder="Şifrenizi girin" required autocomplete="current-password">
				</div>

				<button type="submit" class="login-btn" id="login-btn">
					<span class="btn-text">Giriş Yap</span>
					<svg viewBox="0 0 24 24" fill="currentColor">
						<path d="M10 17l5-5-5-5v10z"/>
						<path d="M3 5v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2zm16 14H5V5h14v14z"/>
					</svg>
					<div class="spinner"></div>
				</button>
			</form>

			<div class="login-footer">
				<p>&copy; 2025 İpragaz - Tüm hakları saklıdır</p>
			</div>
		</div>
	</div>

	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/project-access-service.js"></script>
	<script>
		/**
		 * SHA-256 hash fonksiyonu (SubtleCrypto API)
		 */
		async function sha256(message) {
			const msgBuffer = new TextEncoder().encode(message);
			const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
			const hashArray = Array.from(new Uint8Array(hashBuffer));
			const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
			return hashHex;
		}

		document.addEventListener('DOMContentLoaded', function() {
			// Zaten giriş yapmışsa ana sayfaya yönlendir
			if (sessionStorage.getItem('project_authenticated') === 'true') {
				window.location.href = 'default.html';
				return;
			}

			const form = document.getElementById('login-form');
			const usernameInput = document.getElementById('username');
			const passwordInput = document.getElementById('password');
			const loginBtn = document.getElementById('login-btn');
			const errorMessage = document.getElementById('error-message');
			const errorText = document.getElementById('error-text');

			function showError(message) {
				errorText.textContent = message;
				errorMessage.classList.add('visible');
				usernameInput.classList.add('error');
				passwordInput.classList.add('error');
			}

			function hideError() {
				errorMessage.classList.remove('visible');
				usernameInput.classList.remove('error');
				passwordInput.classList.remove('error');
			}

			function setLoading(loading) {
				if (loading) {
					loginBtn.classList.add('loading');
					loginBtn.disabled = true;
				} else {
					loginBtn.classList.remove('loading');
					loginBtn.disabled = false;
				}
			}

			// Input değiştiğinde hata mesajını gizle
			usernameInput.addEventListener('input', hideError);
			passwordInput.addEventListener('input', hideError);

			// Form submit
			form.addEventListener('submit', async function(e) {
				e.preventDefault();
				hideError();

				const username = usernameInput.value.trim();
				const password = passwordInput.value;

				if (!username || !password) {
					showError('Kullanıcı adı ve şifre gereklidir');
					return;
				}

				setLoading(true);

				try {
					// Şifreyi SHA-256 ile hash'le
					const passwordHash = await sha256(password);

					// Giriş yap
					const { data, error } = await ProjectAccessService.login(username, passwordHash);

					if (error || !data) {
						showError(error || 'Geçersiz kullanıcı adı veya şifre');
						setLoading(false);
						return;
					}

					// Session'a kaydet
					sessionStorage.setItem('project_authenticated', 'true');
					sessionStorage.setItem('project_username', data.username);

					// Ana sayfaya yönlendir
					window.location.href = 'default.html';

				} catch (err) {
					console.error('Login error:', err);
					showError('Bir hata oluştu. Lütfen tekrar deneyin.');
					setLoading(false);
				}
			});
		});
	</script>
</body>
</html>
