<!DOCTYPE html>
<html lang="tr">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Teklif Oluşturma - İpragaz Bayi</title>
	<meta http-equiv="Content-Language" content="Turkish">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<link rel="shortcut icon" type="image/x-icon" media="all" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="stylesheet" type="text/css" href="./İpragaz Bayi_files/css">
	<link rel="stylesheet" type="text/css" media="all" href="./İpragaz Bayi_files/style.css">
	<link rel="stylesheet" href="./css/bayi-teklif-olustur.css">
</head>

<body>
	<!-- Header Component -->
	<div id="bayi-header"></div>

	<!-- Main Content -->
	<main class="main-content content-with-chat">
		<!-- Main Column -->
		<div class="main-column">
			<!-- Page Header -->
			<div class="page-header">
			<a href="bayi-teklif-listesi.html" class="back-btn">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
				</svg>
			</a>
			<div class="page-header-text">
				<h1 id="page-title">Yeni Teklif Oluşturma</h1>
				<p id="page-subtitle">Müşteriye özel fiyat ve taahhüt tanımlayın</p>
			</div>
		</div>

		<!-- Existing Customer Notice -->
		<div class="existing-customer-notice" id="existing-notice">
			<svg viewBox="0 0 24 24" fill="currentColor">
				<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
			</svg>
			<span id="existing-notice-text">Bu müşteriniz için henüz fiyat tanımlamadınız.</span>
		</div>

		<!-- Passive Status Banner -->
		<div class="passive-status-banner" id="passive-status-banner">
			<svg viewBox="0 0 24 24" fill="currentColor">
				<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/>
			</svg>
			<span>TEKLİF PASİF DURUMDA</span>
		</div>

		<!-- Cancelled Status Banner -->
		<div class="cancelled-status-banner" id="cancelled-status-banner">
			<svg viewBox="0 0 24 24" fill="currentColor">
				<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
			</svg>
			<span>BU TEKLİF İPTAL EDİLMİŞTİR</span>
		</div>

		<!-- VKN Search Section -->
		<div class="form-section">
			<div class="section-title">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
				</svg>
				Müşteri Bilgileri
				<div class="countdown-container" id="offer-countdown" style="display: none;">
					<span class="countdown-label">Kalan Süre:</span>
					<span class="countdown-timer" id="countdown-timer">24:00:00</span>
				</div>
			</div>

			<div class="vkn-search-row" id="vkn-search-section">
				<div class="vkn-input-wrapper">
					<label for="vkn-input">Vergi Kimlik Numarası (VKN)</label>
					<input type="text" id="vkn-input" placeholder="10 haneli VKN giriniz" maxlength="10">
				</div>
				<div class="vkn-search-btn">
					<button type="button" id="vkn-search-btn">
						<svg viewBox="0 0 24 24" fill="currentColor">
							<path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
						</svg>
						Sorgula
					</button>
				</div>
			</div>

			<div class="customer-info-box" id="customer-info-box">
				<div class="info-label">Resmi Ünvan</div>
				<div class="info-value" id="customer-name"></div>
			</div>

			<!-- Branch Selector -->
			<div class="branch-selector" id="branch-selector">
				<div class="selector-label">
					<svg viewBox="0 0 24 24" fill="currentColor">
						<path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
					</svg>
					Teklif Verilecek Şube
				</div>
				<select id="branch-select">
					<option value="">Şube seçiniz...</option>
				</select>
				<div class="no-branches" id="no-branches-message" style="display: none;">
					Bu müşterinin sorumluluk alanınızdaki şubesi bulunmuyor.
				</div>
			</div>
		</div>

		<!-- Offer Summary Section -->
		<div class="form-section" id="offer-summary-section" style="display: none;">
			<div class="section-title">
				<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<path d="M9 7h6m-6 4h6m-4 4h4M5 3h14a2 2 0 012 2v14a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2z"/>
				</svg>
				Teklif Özeti
			</div>
			<div class="summary-grid">
				<div class="summary-item">
					<span class="summary-label">Teklifin Perakende Tutarı</span>
					<span class="summary-value" id="total-retail-price">0.00 TL</span>
				</div>
				<div class="summary-item">
					<span class="summary-label">Teklifin İndirimli Tutarı</span>
					<span class="summary-value highlight" id="total-discounted-price">0.00 TL</span>
				</div>
				<div class="summary-item benefit">
					<span class="summary-label">Müşteriye Sağlanan Fayda</span>
					<span class="summary-value benefit-value" id="total-benefit">0.00 TL</span>
				</div>
			</div>
		</div>

		<!-- Products Form Section -->
		<div class="form-section products-form" id="products-form">
			<div class="section-title">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
				</svg>
				Ürün Fiyatları ve Taahhütler
			</div>

			<div id="product-rows">
				<!-- Product rows will be added here dynamically -->
			</div>

			<!-- Yeni Ürün Ekle Bölümü -->
			<div class="add-product-section" id="addProductSection" style="display: none;">
				<button type="button" class="btn-add-product" id="btnAddProduct">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<circle cx="12" cy="12" r="10"/>
						<line x1="12" y1="8" x2="12" y2="16"/>
						<line x1="8" y1="12" x2="16" y2="12"/>
					</svg>
					Yeni Ürün Ekle
				</button>
			</div>

		</div>

		<!-- Ürün Seçim Modalı -->
		<div class="product-modal-overlay" id="productModalOverlay">
			<div class="product-modal">
				<div class="product-modal-header">
					<h3>Ürün Seçin</h3>
					<button type="button" class="modal-close" id="productModalClose">
						<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
							<line x1="18" y1="6" x2="6" y2="18"/>
							<line x1="6" y1="6" x2="18" y2="18"/>
						</svg>
					</button>
				</div>
				<div class="product-modal-search">
					<input type="text" id="productSearchInput" placeholder="Ürün adı veya kodu ile ara...">
				</div>
				<div class="product-modal-body">
					<div class="product-grid" id="productModalGrid">
						<!-- Ürünler JavaScript ile doldurulacak -->
					</div>
				</div>
			</div>
		</div>

		<!-- Teklif Kaydetme Seçenekleri -->
		<div class="save-options" id="save-options" style="display: none;">
			<label class="checkbox-option" for="save-as-accepted">
				<input type="checkbox" id="save-as-accepted">
				<span class="custom-checkbox"></span>
				<span class="checkbox-label">Teklifi "Kabul Edilmiş" olarak kaydet</span>
			</label>
			<label class="checkbox-option slide-option" id="notify-customer-option" for="notify-customer">
				<input type="checkbox" id="notify-customer">
				<span class="custom-checkbox"></span>
				<span class="checkbox-label">Müşteriye bildirim gönder</span>
			</label>
		</div>

		<!-- Form Actions -->
		<div class="form-actions" id="form-actions" style="display: none;">
			<button type="button" class="btn btn-warning" id="passive-customer-btn" style="display: none;">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.42 0-8-3.58-8-8 0-1.85.63-3.55 1.69-4.9L16.9 18.31C15.55 19.37 13.85 20 12 20zm6.31-3.1L7.1 5.69C8.45 4.63 10.15 4 12 4c4.42 0 8 3.58 8 8 0 1.85-.63 3.55-1.69 4.9z"/>
				</svg>
				Pasife Çek
			</button>
			<button type="button" class="btn btn-success" id="activate-customer-btn" style="display: none;">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
				Aktif Et
			</button>
			<button type="button" class="btn btn-danger" id="cancel-offer-btn" style="display: none;">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
				</svg>
				Teklifi İptal Et
			</button>
			<a href="bayi-teklif-listesi.html" class="btn btn-secondary">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
				</svg>
				Vazgeç
			</a>
			<button type="button" class="btn btn-primary" id="save-btn">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
				</svg>
				Kaydet
			</button>
		</div>

		<!-- Teklif Gecmisi Timeline -->
		<details class="offer-metadata" id="offer-metadata" style="display: none;">
			<summary>
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<polyline points="6 9 12 15 18 9"/>
				</svg>
				Teklif gecmisi
			</summary>
			<div class="metadata-timeline" id="metadata-timeline">
				<p class="timeline-empty">Yukleniyor...</p>
			</div>
		</details>
		</div>

		<!-- Chat Column -->
		<aside class="chat-column" id="chatColumn">
			<button class="chat-close-mobile" id="chatCloseMobile" onclick="closeChatMobile()">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="18" y1="6" x2="6" y2="18"/>
					<line x1="6" y1="6" x2="18" y2="18"/>
				</svg>
			</button>
			<div class="chat-header">
				<h3>
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
					</svg>
					Mesajlar
				</h3>
				<span class="chat-badge" id="chatBadge" style="display: none;">0</span>
			</div>
			<div class="chat-messages" id="chatMessages">
				<div class="no-messages" id="noMessages">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
					</svg>
					<p>Henuz mesaj yok</p>
				</div>
			</div>
			<div class="chat-input-wrapper" id="chatInputWrapper">
				<textarea id="messageInput" placeholder="Mesajinizi yazin..." rows="1" onkeydown="handleMessageKeydown(event)"></textarea>
				<button class="btn-send-message" id="btnSendMessage" onclick="sendMessage()">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="22" y1="2" x2="11" y2="13"/>
						<polygon points="22 2 15 22 11 13 2 9 22 2"/>
					</svg>
				</button>
			</div>
			<div class="chat-disabled" id="chatDisabled" style="display: none;">
				<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<circle cx="12" cy="12" r="10"/>
					<line x1="12" y1="8" x2="12" y2="12"/>
					<line x1="12" y1="16" x2="12.01" y2="16"/>
				</svg>
				<p>Musteri secimi yapildiginda mesajlasma aktif olacaktir</p>
			</div>
		</aside>
	</main>

	<!-- Mobile Chat Toggle -->
	<button class="chat-toggle-mobile" id="chatToggleMobile" onclick="openChatMobile()">
		Mesajlar
		<span class="unread-badge" id="unreadBadgeMobile" style="display: none;">0</span>
	</button>

	<!-- Confirm Save Modal -->
	<div class="modal-overlay" id="save-modal">
		<div class="modal">
			<div class="modal-icon">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
			</div>
			<h3>Fiyatları Kaydet</h3>
			<p>Bu müşteri için tanımlanan fiyatları kaydetmek istediğinize emin misiniz?</p>
			<div class="modal-actions">
				<button type="button" class="btn btn-secondary" id="modal-cancel">İptal</button>
				<button type="button" class="btn btn-primary" id="modal-confirm">Onayla</button>
			</div>
		</div>
	</div>

	<!-- Offer Preview Modal -->
	<div class="modal-overlay" id="offer-preview-modal">
		<div class="modal offer-preview-modal">
			<div class="modal-header">
				<h3>Teklif Özeti</h3>
				<button type="button" class="modal-close-btn" id="preview-modal-close">
					<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<line x1="18" y1="6" x2="6" y2="18"/>
						<line x1="6" y1="6" x2="18" y2="18"/>
					</svg>
				</button>
			</div>

			<div class="preview-content">
				<!-- Müşteri Bilgisi -->
				<div class="preview-customer">
					<div class="preview-customer-label">Müşteri</div>
					<div class="preview-customer-name" id="preview-customer-name"></div>
					<div class="preview-customer-branch" id="preview-customer-branch"></div>
				</div>

				<!-- Ürün Listesi -->
				<div class="preview-products">
					<div class="preview-section-title">Ürünler</div>
					<div class="preview-products-list" id="preview-products-list">
						<!-- Dinamik olarak doldurulacak -->
					</div>
				</div>

				<!-- Toplam Tutarlar -->
				<div class="preview-totals">
					<div class="preview-total-row">
						<span>Perakende Tutarı</span>
						<span id="preview-retail-total">0.00 TL</span>
					</div>
					<div class="preview-total-row discount">
						<span>İndirimli Tutarı</span>
						<span id="preview-discounted-total">0.00 TL</span>
					</div>
					<div class="preview-total-row benefit">
						<span>Müşteri Faydası</span>
						<span id="preview-benefit-total">0.00 TL</span>
					</div>
				</div>
			</div>

			<div class="modal-actions">
				<button type="button" class="btn btn-secondary" id="preview-modal-cancel">Vazgeç</button>
				<button type="button" class="btn btn-primary btn-send" id="preview-modal-send">
					<svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
						<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
					</svg>
					TEKLİFİ GÖNDER
				</button>
			</div>
		</div>
	</div>

	<!-- Pasife Çek Modal -->
	<div class="modal-overlay" id="passive-modal">
		<div class="modal">
			<div class="modal-icon warning">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
				</svg>
			</div>
			<h3>Teklifi Pasife Çek</h3>
			<div class="modal-message">
				<p>Bu teklifi pasife çekmek üzeresiniz.</p>
				<p>Pasife çekerseniz müşteri bu teklifte belirlediğiniz fiyatlardan sipariş veremeyecektir.</p>
				<p>İstediğiniz zaman tekrar aktif edebilirsiniz.</p>
			</div>
			<div class="modal-actions">
				<button type="button" class="btn btn-secondary" id="passive-modal-cancel">İptal</button>
				<button type="button" class="btn btn-warning" id="passive-modal-confirm">Pasife Çek</button>
			</div>
		</div>
	</div>

	<!-- Aktif Et Modal -->
	<div class="modal-overlay" id="activate-modal">
		<div class="modal">
			<div class="modal-icon" style="background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);">
				<svg viewBox="0 0 24 24" fill="currentColor" style="color: #4caf50;">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
			</div>
			<h3>Teklifi Aktif Et</h3>
			<div class="modal-message">
				<p>Bu teklifi tekrar aktif etmek üzeresiniz.</p>
				<p>Aktif edildikten sonra müşteri bu fiyatlardan sipariş verebilecektir.</p>
			</div>
			<div class="modal-actions">
				<button type="button" class="btn btn-secondary" id="activate-modal-cancel">İptal</button>
				<button type="button" class="btn btn-success" id="activate-modal-confirm">Aktif Et</button>
			</div>
		</div>
	</div>

	<!-- Teklifi İptal Et Modal -->
	<div class="modal-overlay" id="cancel-offer-modal">
		<div class="modal">
			<div class="modal-icon warning">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
				</svg>
			</div>
			<h3>Teklifi İptal Et</h3>
			<div class="modal-message">
				<p>Bu teklifi iptal etmek üzeresiniz.</p>
				<p>İptal edildikten sonra müşteri bu teklifi göremeyecek ve bu fiyatlardan sipariş veremeyecektir.</p>
			</div>
			<div class="modal-actions">
				<button type="button" class="btn btn-secondary" id="cancel-offer-modal-cancel">Vazgeç</button>
				<button type="button" class="btn btn-danger" id="cancel-offer-modal-confirm">İptal Et</button>
			</div>
		</div>
	</div>

	<!-- Success Message -->
	<div class="success-message" id="success-message">
		<svg viewBox="0 0 24 24" fill="currentColor">
			<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
		</svg>
		<span>Fiyatlar başarıyla kaydedildi!</span>
	</div>

	<!-- Mobile Sidebar Component -->
	<div id="bayi-mobile-sidebar"></div>

	<script src="./İpragaz Bayi_files/jquery-3.6.0.min.js"></script>
	<!-- Supabase -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/products-service.js"></script>
	<script src="./js/services/customers-service.js"></script>
	<script src="./js/services/offers-service.js"></script>
	<script src="./js/services/offer-logs-service.js"></script>
	<script src="./js/services/dealers-service.js"></script>
	<script src="./js/services/messages-service.js"></script>
	<script src="./js/services/notifications-service.js"></script>
	<script src="./js/services/locations-service.js"></script>
	<script src="./js/services/retail-prices-by-city-service.js"></script>
	<script src="./js/services/branches-service.js"></script>
	<script src="./js/component-loader.js"></script>
	<script src="./js/bayi-teklif-olustur.js"></script>
</body>
</html>
