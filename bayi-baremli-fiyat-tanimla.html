<!DOCTYPE html>
<html lang="tr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

	<title>Baremli Fiyat Tanımla - İpragaz Bayi</title>

	<meta http-equiv="Content-Language" content="Turkish">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<meta name="keywords">
	<meta name="description">
	<meta name="robots" content="index,follow">
	<link rel="shortcut icon" type="image/x-icon" media="all" href="https://ipappbayi.ipragaz.com.tr/bayi/_ui/responsive/theme-ipragaz/images/faviconNew.jpg">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="./İpragaz Bayi_files/css">
	<link rel="stylesheet" type="text/css" media="all" href="./İpragaz Bayi_files/style.css">
	<link rel="stylesheet" type="text/css" media="all" href="./İpragaz Bayi_files/smarteditaddon.css">

	<style>
		/* Main Content - Consistent Width */
		.page-baremli-fiyat.main {
			padding-top: 0 !important;
			margin-top: 0 !important;
		}

		.page-baremli-fiyat .container {
			max-width: 1200px;
			margin: 0 auto;
			padding: 30px 20px;
		}

		/* Page Header - Back Button Style */
		.page-header {
			display: flex;
			align-items: center;
			gap: 15px;
			margin-bottom: 25px;
		}

		.back-btn {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 44px;
			height: 44px;
			border-radius: 12px;
			background: #fff;
			border: 1px solid #e0e0e0;
			color: #666;
			text-decoration: none;
			transition: all 0.2s;
			box-shadow: 0 2px 8px rgba(0,0,0,0.05);
		}

		.back-btn:hover {
			background: #f5f7fa;
			border-color: #002c77;
			color: #002c77;
			transform: translateX(-2px);
		}

		.back-btn svg {
			width: 22px;
			height: 22px;
		}

		.page-header-text h1 {
			font-size: 24px;
			color: #1a1a2e;
			font-weight: 700;
			margin-bottom: 4px;
		}

		.page-header-text p {
			color: #666;
			font-size: 14px;
			margin: 0;
		}

		/* Baremli Fiyat Form Styles */

		.baremli-fiyat-container {
			background: #fff;
			border-radius: 12px;
			padding: 30px;
			box-shadow: 0 2px 10px rgba(0,0,0,0.05);
			margin-bottom: 30px;
		}

		.product-select-section {
			margin-bottom: 30px;
		}

		.product-select-section .section-title {
			font-size: 16px;
			font-weight: 600;
			color: #333;
			margin-bottom: 20px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.product-select-section .section-title svg {
			color: #002c77;
		}

		/* Product Cards Carousel */
		.product-carousel-container {
			position: relative;
			padding: 0 30px;
		}

		.product-cards-wrapper {
			overflow-x: auto;
			overflow-y: visible;
			scroll-behavior: smooth;
			padding: 70px 0 15px;
			margin-top: -65px;
			scrollbar-width: none; /* Firefox */
			-ms-overflow-style: none; /* IE/Edge */
		}

		.product-cards-wrapper::-webkit-scrollbar {
			display: none; /* Chrome/Safari */
		}

		.product-cards-grid {
			display: grid;
			grid-template-columns: repeat(6, minmax(160px, 1fr));
			gap: 16px;
			min-width: max-content;
		}

		@media (min-width: 1200px) {
			.product-cards-grid {
				grid-template-columns: repeat(6, 1fr);
				min-width: auto;
			}
		}

		/* Carousel Navigation Arrows */
		.carousel-nav-btn {
			position: absolute;
			top: 50%;
			transform: translateY(-70%);
			width: 44px;
			height: 44px;
			border-radius: 50%;
			background: #fff;
			border: 2px solid #e5e5e5;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			z-index: 10;
			transition: all 0.3s ease;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
		}

		.carousel-nav-btn:hover {
			background: #002c77;
			border-color: #002c77;
		}

		.carousel-nav-btn:hover svg {
			color: #fff;
		}

		.carousel-nav-btn svg {
			width: 20px;
			height: 20px;
			color: #666;
			transition: color 0.3s;
		}

		.carousel-nav-btn.prev {
			left: -8px;
		}

		.carousel-nav-btn.next {
			right: -8px;
		}

		.carousel-nav-btn:disabled {
			opacity: 0.4;
			cursor: not-allowed;
			background: #f5f5f5;
		}

		.carousel-nav-btn:disabled:hover {
			background: #f5f5f5;
			border-color: #e5e5e5;
		}

		.carousel-nav-btn:disabled:hover svg {
			color: #666;
		}

		/* Carousel Dots */
		.carousel-dots {
			display: flex;
			justify-content: center;
			gap: 8px;
			margin-top: 15px;
		}

		.carousel-dot {
			width: 10px;
			height: 10px;
			border-radius: 50%;
			background: #ddd;
			border: none;
			cursor: pointer;
			transition: all 0.3s ease;
			padding: 0;
		}

		.carousel-dot:hover {
			background: #bbb;
			transform: scale(1.2);
		}

		.carousel-dot.active {
			background: #002c77;
			transform: scale(1.2);
		}

		.carousel-dots.disabled .carousel-dot {
			opacity: 0.4;
			cursor: not-allowed;
		}

		.carousel-dots.disabled .carousel-dot:hover {
			transform: none;
			background: #ddd;
		}

		.carousel-dots.disabled .carousel-dot.active {
			transform: scale(1.2);
		}

		/* Responsive arrows */
		@media (max-width: 768px) {
			.product-carousel-container {
				padding: 0 25px;
			}

			.carousel-nav-btn {
				width: 36px;
				height: 36px;
			}

			.carousel-nav-btn.prev {
				left: -5px;
			}

			.carousel-nav-btn.next {
				right: -5px;
			}

			.carousel-nav-btn svg {
				width: 16px;
				height: 16px;
			}
		}

		@media (max-width: 480px) {
			.product-carousel-container {
				padding: 0 20px;
			}

			.carousel-nav-btn {
				width: 32px;
				height: 32px;
			}

			.carousel-nav-btn.prev {
				left: -2px;
			}

			.carousel-nav-btn.next {
				right: -2px;
			}

			.carousel-dot {
				width: 8px;
				height: 8px;
			}
		}

		.product-card {
			background: #fff;
			border: 2px solid #e5e5e5;
			border-radius: 12px;
			padding: 20px 15px;
			cursor: pointer;
			transition: all 0.3s ease;
			text-align: center;
			position: relative;
			overflow: hidden;
		}

		.product-card:hover {
			border-color: #002c77;
			transform: translateY(-4px);
			box-shadow: 0 8px 25px rgba(0, 44, 119, 0.15);
		}

		.product-card.selected {
			border-color: #002c77;
			background: linear-gradient(135deg, #f0f4ff 0%, #e8efff 100%);
			box-shadow: 0 4px 15px rgba(0, 44, 119, 0.2);
		}

		.product-card.selected::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			height: 4px;
			background: linear-gradient(90deg, #002c77, #0056b3);
		}

		.product-card .check-icon {
			position: absolute;
			top: 10px;
			right: 10px;
			width: 24px;
			height: 24px;
			background: #002c77;
			border-radius: 50%;
			display: none;
			align-items: center;
			justify-content: center;
		}

		.product-card.selected .check-icon {
			display: flex;
		}

		.product-card .check-icon svg {
			width: 14px;
			height: 14px;
			color: #fff;
		}

		.product-card .product-image {
			width: 80px;
			height: 80px;
			margin: 0 auto 15px;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #f8f9fa;
			border-radius: 10px;
			padding: 10px;
			transition: transform 0.3s;
		}

		.product-card:hover .product-image {
			transform: scale(1.05);
		}

		.product-card .product-image img {
			max-width: 100%;
			max-height: 100%;
			object-fit: contain;
		}

		.product-card .product-name {
			font-size: 14px;
			font-weight: 600;
			color: #333;
			margin-bottom: 5px;
			line-height: 1.3;
		}

		.product-card .product-desc {
			font-size: 12px;
			color: #888;
		}

		.product-card .product-tag {
			display: inline-block;
			margin-top: 10px;
			padding: 4px 10px;
			background: #e8f5e9;
			color: #2e7d32;
			font-size: 11px;
			font-weight: 500;
			border-radius: 20px;
		}

		.product-card.selected .product-tag {
			background: #002c77;
			color: #fff;
		}

		/* Seçilmemiş kartlar pasif görünsün */
		.product-cards-grid.has-selection .product-card:not(.selected) {
			opacity: 0.5;
			transform: scale(0.95);
		}

		.product-cards-grid.has-selection .product-card:not(.selected):hover {
			opacity: 0.8;
			transform: scale(1);
		}

		/* Baremi olmayan ürünler - Kırmızı stil */
		.product-card.no-barem {
			border-color: #ffcdd2;
			background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
			position: relative;
			overflow: visible;
		}

		.product-card.no-barem::after {
			content: '!';
			position: absolute;
			top: 10px;
			left: 10px;
			width: 22px;
			height: 22px;
			background: #e53935;
			color: #fff;
			border-radius: 50%;
			font-size: 14px;
			font-weight: 700;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.product-card.no-barem:hover {
			border-color: #e53935;
			box-shadow: 0 8px 25px rgba(229, 57, 53, 0.2);
		}

		.product-card.no-barem .product-tag {
			background: #ffebee;
			color: #c62828;
		}

		.product-card.no-barem.selected {
			border-color: #e53935;
			background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
		}

		.product-card.no-barem.selected::before {
			background: linear-gradient(90deg, #e53935, #f44336);
		}

		/* Tooltip - sadece baremi olmayan ürünlerde hover'da görünür */
		.product-card.no-barem .barem-tooltip {
			position: absolute;
			bottom: calc(100% + 8px);
			left: 50%;
			transform: translateX(-50%);
			background: #c62828;
			color: #fff;
			padding: 10px 14px;
			border-radius: 8px;
			font-size: 12px;
			font-weight: 500;
			white-space: nowrap;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s ease;
			z-index: 9999;
			box-shadow: 0 4px 12px rgba(0,0,0,0.25);
			pointer-events: none;
		}

		.product-card.no-barem .barem-tooltip::after {
			content: '';
			position: absolute;
			top: 100%;
			left: 50%;
			transform: translateX(-50%);
			border-left: 8px solid transparent;
			border-right: 8px solid transparent;
			border-top: 8px solid #c62828;
		}

		.product-card.no-barem:hover .barem-tooltip {
			opacity: 1;
			visibility: visible;
			bottom: calc(100% + 12px);
		}

		.barem-table-container {
			overflow-x: auto;
			margin-top: 20px;
		}

		.barem-table {
			width: 100%;
			border-collapse: collapse;
			min-width: 600px;
		}

		.barem-table thead {
			background: #002c77;
			color: #fff;
		}

		.barem-table th {
			padding: 15px 12px;
			text-align: left;
			font-weight: 600;
			font-size: 14px;
		}

		.barem-table tbody tr {
			border-bottom: 1px solid #eee;
			transition: background 0.3s;
		}

		.barem-table tbody tr:hover {
			background: #f8f9fa;
		}

		.barem-table td {
			padding: 12px;
			vertical-align: middle;
		}

		.barem-table input[type="number"] {
			width: 100%;
			padding: 10px 12px;
			border: 1px solid #ddd;
			border-radius: 6px;
			font-size: 14px;
			transition: border-color 0.3s;
		}

		.barem-table input[type="number"]:focus {
			outline: none;
			border-color: #002c77;
		}

		.barem-table .min-max-inputs {
			display: flex;
			gap: 10px;
			align-items: center;
		}

		.barem-table .min-max-inputs span {
			color: #666;
			font-size: 12px;
		}

		.barem-table .min-max-inputs input {
			width: 80px;
		}

		.barem-row-actions {
			display: flex;
			gap: 8px;
		}

		.btn-icon {
			width: 36px;
			height: 36px;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			transition: background 0.3s;
		}

		.btn-icon.btn-delete {
			background: #ffebee;
			color: #c62828;
		}

		.btn-icon.btn-delete:hover {
			background: #ffcdd2;
		}

		.btn-icon svg {
			width: 18px;
			height: 18px;
		}

		.add-barem-row {
			margin-top: 20px;
		}

		.btn-add-row {
			background: #e3f2fd;
			color: #1565c0;
			border: 1px dashed #1565c0;
			padding: 12px 24px;
			border-radius: 8px;
			font-size: 14px;
			font-weight: 500;
			cursor: pointer;
			transition: all 0.3s;
			display: inline-flex;
			align-items: center;
			gap: 8px;
		}

		.btn-add-row:hover {
			background: #bbdefb;
		}

		.form-actions {
			display: flex;
			gap: 20px;
			margin-top: 40px;
			padding-top: 30px;
			border-top: 1px solid #eee;
		}

		.btn {
			padding: 16px 40px;
			font-size: 15px;
			font-weight: 600;
			border: none;
			border-radius: 12px;
			cursor: pointer;
			transition: all 0.3s ease;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			gap: 10px;
			position: relative;
			overflow: hidden;
		}

		.btn::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
			transition: left 0.5s ease;
		}

		.btn:hover::before {
			left: 100%;
		}

		.btn svg {
			width: 20px;
			height: 20px;
			transition: transform 0.3s ease;
		}

		.btn:hover svg {
			transform: scale(1.1);
		}

		.btn-primary {
			background: linear-gradient(135deg, #002c77 0%, #0044a8 100%);
			color: #fff;
			box-shadow: 0 4px 15px rgba(0, 44, 119, 0.3);
		}

		.btn-primary:hover {
			background: linear-gradient(135deg, #001d52 0%, #003080 100%);
			box-shadow: 0 6px 25px rgba(0, 44, 119, 0.4);
			transform: translateY(-2px);
		}

		.btn-primary:active {
			transform: translateY(0);
			box-shadow: 0 2px 10px rgba(0, 44, 119, 0.3);
		}

		.btn-primary.success {
			background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
			box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
		}

		.btn-primary.success:hover {
			background: linear-gradient(135deg, #218838 0%, #1ea882 100%);
			box-shadow: 0 6px 25px rgba(40, 167, 69, 0.4);
		}

		.btn-primary.error {
			background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
			box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
		}

		.btn-primary.error:hover {
			background: linear-gradient(135deg, #c82333 0%, #bd2130 100%);
			box-shadow: 0 6px 25px rgba(220, 53, 69, 0.4);
		}

		#save-btn .icon-success,
		#save-btn .icon-error {
			display: none;
		}

		#save-btn.success .icon-save { display: inline-block; }
		#save-btn.success .icon-success { display: none; }
		#save-btn.success .btn-text { color: #fff; }

		#save-btn.error .icon-save { display: none; }
		#save-btn.error .icon-error { display: inline-block; }
		#save-btn.error .btn-text { color: #fff; }

		/* Ürün yükleniyor placeholder */
		.products-loading {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			padding: 60px 20px;
			color: #6c757d;
			width: 100%;
			min-height: 180px;
			grid-column: 1 / -1; /* Tüm sütunları kapla */
		}

		.products-loading .spinner {
			width: 44px;
			height: 44px;
			border: 4px solid #e9ecef;
			border-top-color: #002c77;
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-bottom: 16px;
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		.products-loading .loading-text {
			font-size: 15px;
			font-weight: 500;
			color: #495057;
		}

		.btn-secondary {
			background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
			color: #495057;
			border: 1px solid #dee2e6;
			box-shadow: 0 2px 8px rgba(0,0,0,0.05);
		}

		.btn-secondary:hover {
			background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
			border-color: #ced4da;
			box-shadow: 0 4px 12px rgba(0,0,0,0.1);
			transform: translateY(-2px);
		}

		.btn-secondary:active {
			transform: translateY(0);
			box-shadow: 0 1px 4px rgba(0,0,0,0.05);
		}

		/* Barem Section Title */
		.barem-section-title {
			font-size: 16px;
			font-weight: 600;
			color: #333;
			margin-bottom: 15px;
			margin-top: 30px;
			display: flex;
			align-items: center;
			gap: 10px;
		}

		.barem-section-title svg {
			color: #002c77;
		}

		/* Barem Empty State */
		.barem-empty-state {
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			min-height: 350px;
			background: linear-gradient(135deg, #f8f9fa 0%, #fff 100%);
			border: 2px dashed #ddd;
			border-radius: 16px;
			padding: 40px 20px;
			text-align: center;
			margin-top: 30px;
		}

		.barem-empty-state .empty-icon {
			width: 80px;
			height: 80px;
			background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
			border-radius: 50%;
			display: flex;
			align-items: center;
			justify-content: center;
			margin-bottom: 25px;
		}

		.barem-empty-state .empty-icon svg {
			width: 40px;
			height: 40px;
			color: #1976d2;
		}

		.barem-empty-state h3 {
			font-size: 18px;
			color: #333;
			margin-bottom: 10px;
			font-weight: 600;
		}

		.barem-empty-state p {
			font-size: 15px;
			color: #666;
			max-width: 400px;
			line-height: 1.6;
		}

		.barem-empty-state .arrow-hint {
			margin-top: 20px;
			display: flex;
			align-items: center;
			gap: 8px;
			color: #1976d2;
			font-size: 14px;
			font-weight: 500;
		}

		.barem-empty-state .arrow-hint svg {
			width: 20px;
			height: 20px;
			animation: bounce-up 1.5s ease-in-out infinite;
		}

		@keyframes bounce-up {
			0%, 100% { transform: translateY(0); }
			50% { transform: translateY(-8px); }
		}

		/* Barem Content - initially hidden */
		.barem-content {
			display: none;
		}

		.barem-content.active {
			display: block;
		}

		.info-box {
			background: #fff3e0;
			border-left: 4px solid #ff9800;
			padding: 15px 20px;
			border-radius: 0 8px 8px 0;
			margin-bottom: 25px;
		}

		.info-box p {
			color: #e65100;
			font-size: 14px;
			margin: 0;
		}

		.info-box strong {
			font-weight: 600;
		}

		/* Onay Modalı */
		.confirm-modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.6);
			z-index: 2000;
			display: none;
			align-items: center;
			justify-content: center;
			padding: 20px;
		}

		.confirm-modal-overlay.active {
			display: flex;
		}

		.confirm-modal {
			background: #fff;
			border-radius: 16px;
			max-width: 500px;
			width: 100%;
			max-height: 90vh;
			overflow-y: auto;
			box-shadow: 0 20px 60px rgba(0,0,0,0.3);
		}

		.confirm-modal-header {
			background: linear-gradient(135deg, #002c77 0%, #0056b3 100%);
			color: #fff;
			padding: 25px;
			text-align: center;
			border-radius: 16px 16px 0 0;
		}

		.confirm-modal-header h3 {
			margin: 0 0 5px;
			font-size: 20px;
		}

		.confirm-modal-header p {
			margin: 0;
			opacity: 0.9;
			font-size: 14px;
		}

		.confirm-modal-product {
			display: flex;
			align-items: center;
			gap: 20px;
			padding: 25px;
			background: #f8f9fa;
			border-bottom: 1px solid #eee;
		}

		.confirm-modal-product img {
			width: 80px;
			height: 80px;
			object-fit: contain;
			background: #fff;
			border-radius: 10px;
			padding: 10px;
			border: 1px solid #e5e5e5;
		}

		.confirm-modal-product .product-info h4 {
			margin: 0 0 8px;
			font-size: 18px;
			color: #333;
		}

		.confirm-modal-product .product-info span {
			display: inline-block;
			background: #e3f2fd;
			color: #1565c0;
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 12px;
			font-weight: 500;
		}

		.confirm-modal-barems {
			padding: 25px;
		}

		.confirm-modal-barems h4 {
			margin: 0 0 15px;
			font-size: 15px;
			color: #666;
			display: flex;
			align-items: center;
			gap: 8px;
		}

		.confirm-modal-barems h4 svg {
			width: 20px;
			height: 20px;
			color: #4caf50;
		}

		.confirm-barem-list {
			display: flex;
			flex-direction: column;
			gap: 12px;
		}

		.confirm-barem-item {
			display: flex;
			align-items: stretch;
			background: #fff;
			border-radius: 12px;
			overflow: hidden;
			border: 1px solid #e0e0e0;
			box-shadow: 0 2px 4px rgba(0,0,0,0.05);
		}

		.confirm-barem-item .barem-number {
			background: linear-gradient(135deg, #002c77 0%, #0056b3 100%);
			color: #fff;
			min-width: 50px;
			display: flex;
			align-items: center;
			justify-content: center;
			font-weight: 700;
			font-size: 18px;
		}

		.confirm-barem-item .barem-range {
			flex: 1;
			display: flex;
			flex-direction: column;
			justify-content: center;
			padding: 15px 20px;
			background: #f8f9fa;
			border-right: 1px solid #e0e0e0;
		}

		.confirm-barem-item .barem-range-label {
			font-size: 11px;
			color: #888;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 4px;
		}

		.confirm-barem-item .barem-range-value {
			font-size: 17px;
			font-weight: 600;
			color: #333;
		}

		.confirm-barem-item .barem-price {
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: flex-end;
			padding: 15px 20px;
			min-width: 120px;
		}

		.confirm-barem-item .barem-price-label {
			font-size: 11px;
			color: #888;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			margin-bottom: 4px;
		}

		.confirm-barem-item .barem-price-value {
			font-size: 20px;
			font-weight: 700;
			color: #2e7d32;
		}

		.confirm-modal-actions {
			display: flex;
			gap: 12px;
			padding: 20px 25px 25px;
			border-top: 1px solid #eee;
		}

		.confirm-modal-actions .btn {
			flex: 1;
			padding: 14px 20px;
		}

		.btn-confirm {
			background: linear-gradient(135deg, #4caf50 0%, #43a047 100%);
			color: #fff;
			box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
		}

		.btn-confirm:hover {
			background: linear-gradient(135deg, #43a047 0%, #388e3c 100%);
			box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
			transform: translateY(-2px);
		}

		.btn-cancel {
			background: #fff;
			color: #666;
			border: 2px solid #ddd;
		}

		.btn-cancel:hover {
			border-color: #bbb;
			background: #f5f5f5;
		}

		/* Responsive */
		@media (max-width: 992px) {
			.product-cards-grid {
				grid-template-columns: repeat(6, minmax(150px, 180px));
			}
		}

		@media (max-width: 768px) {
			.baremli-fiyat-container {
				padding: 20px 15px;
			}

			.product-cards-grid {
				grid-template-columns: repeat(6, minmax(140px, 160px));
				gap: 12px;
			}

			.product-card {
				padding: 15px 10px;
			}

			.product-card .product-image {
				width: 60px;
				height: 60px;
			}

			.product-card .product-name {
				font-size: 13px;
			}

			.form-actions {
				flex-direction: column;
			}

			.btn {
				width: 100%;
				text-align: center;
			}

			/* Mobil Barem Tablosu - Card Tasarımı */
			.barem-table-container {
				overflow-x: visible;
			}

			.barem-table {
				min-width: auto;
				display: block;
			}

			.barem-table thead {
				display: none;
			}

			.barem-table tbody {
				display: flex;
				flex-direction: column;
				gap: 16px;
			}

			.barem-table tbody tr {
				display: block;
				background: #fff;
				border: 1px solid #e5e5e5;
				border-radius: 12px;
				padding: 16px;
				box-shadow: 0 2px 8px rgba(0,0,0,0.05);
				position: relative;
			}

			.barem-table tbody tr:hover {
				background: #fff;
			}

			.barem-table td {
				display: block;
				padding: 0;
				margin-bottom: 12px;
			}

			.barem-table td:first-child {
				position: absolute;
				top: 12px;
				left: 16px;
				width: 28px;
				height: 28px;
				background: linear-gradient(135deg, #002c77 0%, #0056b3 100%);
				color: #fff;
				border-radius: 50%;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 700;
				font-size: 14px;
				margin-bottom: 0;
			}

			.barem-table td:nth-child(2) {
				padding-top: 8px;
				padding-left: 44px;
			}

			.barem-table td:nth-child(3) {
				padding-left: 0;
			}

			.barem-table td:last-child {
				position: absolute;
				top: 12px;
				right: 12px;
				margin-bottom: 0;
			}

			.barem-table .min-max-inputs {
				flex-direction: row;
				flex-wrap: wrap;
				gap: 8px;
				align-items: center;
			}

			.barem-table .min-max-inputs input {
				width: 70px;
				padding: 10px 8px;
				font-size: 15px;
				text-align: center;
			}

			.barem-table .min-max-inputs span {
				font-size: 14px;
				color: #666;
			}

			.barem-table .min-max-inputs span:last-child {
				flex-basis: 100%;
				margin-top: -4px;
				font-size: 12px;
				color: #888;
			}

			.barem-table td:nth-child(3)::before {
				content: 'Birim Fiyat (TL)';
				display: block;
				font-size: 12px;
				font-weight: 600;
				color: #666;
				margin-bottom: 6px;
				text-transform: uppercase;
				letter-spacing: 0.5px;
			}

			.barem-table td:nth-child(3) input {
				width: 100%;
				padding: 12px;
				font-size: 16px;
				font-weight: 600;
				background: #f8f9fa;
				border: 2px solid #e5e5e5;
			}

			.barem-table td:nth-child(3) input:focus {
				background: #fff;
				border-color: #002c77;
			}

			.btn-icon.btn-delete {
				width: 32px;
				height: 32px;
			}

			.btn-icon.btn-delete svg {
				width: 16px;
				height: 16px;
			}

			.btn-add-row {
				width: 100%;
				justify-content: center;
				padding: 14px 20px;
			}
		}

		@media (max-width: 480px) {
			.product-cards-grid {
				grid-template-columns: repeat(6, minmax(130px, 150px));
			}

			.product-card .product-desc {
				display: none;
			}

			/* Daha küçük ekranlar için barem kartları */
			.barem-table tbody tr {
				padding: 14px 12px;
			}

			.barem-table td:first-child {
				width: 26px;
				height: 26px;
				font-size: 13px;
				top: 10px;
				left: 12px;
			}

			.barem-table td:nth-child(2) {
				padding-left: 40px;
			}

			.barem-table .min-max-inputs input {
				width: 60px;
				padding: 8px 6px;
				font-size: 14px;
			}

			.barem-table .min-max-inputs span {
				font-size: 13px;
			}

			.barem-table td:nth-child(3) input {
				padding: 10px;
				font-size: 15px;
			}

			.barem-table td:last-child {
				top: 10px;
				right: 10px;
			}

			.btn-icon.btn-delete {
				width: 28px;
				height: 28px;
			}

			.barem-section-title {
				font-size: 14px;
				flex-wrap: wrap;
			}

			.barem-section-title svg {
				width: 20px;
				height: 20px;
			}
		}

		/* Mobile Menu Styles */
		.menu-overlay {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: rgba(0, 0, 0, 0.5);
			z-index: 998;
			opacity: 0;
			visibility: hidden;
			transition: all 0.3s ease;
		}

		.menu-overlay.active {
			opacity: 1;
			visibility: visible;
		}

		body.menu-open {
			overflow: hidden;
		}

		/* Mobile Sidebar Menu - Modern Design */
		.mobile-sidebar {
			position: fixed;
			top: 0;
			right: -320px;
			width: 300px;
			height: 100vh;
			background: #f8f9fa;
			z-index: 1000;
			transition: right 0.3s ease;
			display: flex;
			flex-direction: column;
		}

		.mobile-sidebar.active {
			right: 0;
		}

		/* Header */
		.mobile-sidebar-header {
			padding: 20px;
			background: #fff;
			display: flex;
			align-items: center;
			justify-content: space-between;
			border-bottom: 1px solid #eee;
		}

		.mobile-sidebar-header .logo {
			height: 32px;
		}

		.mobile-sidebar-close {
			width: 36px;
			height: 36px;
			cursor: pointer;
			display: flex;
			align-items: center;
			justify-content: center;
			background: #f5f5f5;
			border-radius: 50%;
			transition: all 0.2s;
		}

		.mobile-sidebar-close:hover {
			background: #eee;
		}

		.mobile-sidebar-close svg {
			width: 20px;
			height: 20px;
			color: #666;
		}

		/* Menu */
		.mobile-sidebar-menu {
			flex: 1;
			padding: 15px;
			overflow-y: auto;
		}

		.mobile-sidebar-menu ul {
			list-style: none;
			margin: 0;
			padding: 0;
		}

		.mobile-sidebar-menu > ul > li {
			margin-bottom: 6px;
		}

		.mobile-sidebar-menu > ul > li > a {
			display: flex;
			align-items: center;
			gap: 12px;
			padding: 14px 16px;
			color: #333;
			font-size: 15px;
			font-weight: 500;
			text-decoration: none;
			background: #fff;
			border-radius: 10px;
			transition: all 0.2s;
			border: 1px solid transparent;
		}

		.mobile-sidebar-menu > ul > li > a:hover {
			border-color: #e0e0e0;
			background: #fff;
		}

		.mobile-sidebar-menu > ul > li.active > a {
			background: #002c77;
			color: #fff;
		}

		.mobile-sidebar-menu > ul > li > a .menu-icon {
			width: 20px;
			height: 20px;
			opacity: 0.7;
		}

		.mobile-sidebar-menu > ul > li.active > a .menu-icon {
			opacity: 1;
			filter: brightness(0) invert(1);
		}

		/* Divider */
		.mobile-sidebar-menu .menu-divider {
			height: 1px;
			background: #e5e5e5;
			margin: 15px 0;
		}

		/* Footer */
		.mobile-sidebar-footer {
			padding: 15px 20px;
			background: #fff;
			border-top: 1px solid #eee;
		}

		.mobile-sidebar-footer-top {
			display: flex;
			align-items: center;
			justify-content: space-between;
			margin-bottom: 15px;
		}

		.mobile-sidebar-footer .date-info {
			display: flex;
			align-items: center;
			gap: 8px;
			font-size: 14px;
			color: #666;
		}

		.mobile-sidebar-footer .date-info svg {
			width: 18px;
			height: 18px;
			color: #999;
		}

		.mobile-sidebar-footer .footer-icons {
			display: flex;
			align-items: center;
			gap: 12px;
		}

		.mobile-sidebar-footer .footer-icons a {
			display: flex;
			align-items: center;
			justify-content: center;
			width: 42px;
			height: 42px;
			background: #f5f5f5;
			border-radius: 10px;
			position: relative;
			transition: all 0.2s;
		}

		.mobile-sidebar-footer .footer-icons a:hover {
			background: #eee;
		}

		.mobile-sidebar-footer .footer-icons img {
			width: 22px;
			height: 22px;
		}

		.mobile-sidebar-footer .footer-icons .cart-badge {
			position: absolute;
			top: -4px;
			right: -4px;
			background: #e53935;
			color: #fff;
			font-size: 11px;
			font-weight: 600;
			min-width: 18px;
			height: 18px;
			padding: 0 5px;
			border-radius: 9px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		/* Logout Button */
		.mobile-sidebar-footer .logout-btn {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 8px;
			width: 100%;
			padding: 12px;
			background: #fff;
			border: 1px solid #e53935;
			color: #e53935;
			font-size: 14px;
			font-weight: 500;
			border-radius: 8px;
			cursor: pointer;
			transition: all 0.2s;
			text-decoration: none;
		}

		.mobile-sidebar-footer .logout-btn:hover {
			background: #e53935;
			color: #fff;
		}

		.mobile-sidebar-footer .logout-btn svg {
			width: 18px;
			height: 18px;
		}

		@media (max-width: 991px) {
			.header__mobile {
				display: flex;
				align-items: center;
				justify-content: center;
				width: 40px;
				height: 40px;
				cursor: pointer;
				z-index: 1001;
			}

			.header__mobile span,
			.header__mobile span::before,
			.header__mobile span::after {
				display: block;
				width: 24px;
				height: 2px;
				background: #002c77;
				transition: all 0.3s ease;
				position: relative;
			}

			.header__mobile span::before,
			.header__mobile span::after {
				content: '';
				position: absolute;
				left: 0;
			}

			.header__mobile span::before {
				top: -8px;
			}

			.header__mobile span::after {
				top: 8px;
			}

			.header__mobile.active span {
				background: transparent;
			}

			.header__mobile.active span::before {
				top: 0;
				transform: rotate(45deg);
			}

			.header__mobile.active span::after {
				top: 0;
				transform: rotate(-45deg);
			}

			/* Eski menüyü mobilde gizle - sadece yeni sidebar görünsün */
			.header__wrapper:last-child .header__nav {
				display: none !important;
			}

			.header__nav.opened {
				display: none !important;
			}
		}
	</style>
</head>

<body class="language-tr">

	<!-- Header Component -->
	<div id="bayi-header"></div>

    <main class="page-baremli-fiyat main">
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <a href="bayi-anasayfa.html" class="back-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                </a>
                <div class="page-header-text">
                    <h1>Baremli Fiyat Tanımla</h1>
                    <p>Ürün gruplarına göre baremli fiyat tanımlayın</p>
                </div>
            </div>

            <div class="baremli-fiyat-container">
                <div class="info-box">
                    <p><strong>Bilgi:</strong> Baremli fiyatlandırma ile adet miktarına göre farklı birim fiyatları tanımlayabilirsiniz. Minimum ve maksimum adet aralıklarını belirleyerek her aralık için ayrı fiyat girebilirsiniz.</p>
                </div>

                <div class="product-select-section">
                    <div class="section-title">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                        </svg>
                        Fiyatlandırma Yapılacak Ürünü Seçiniz
                    </div>

                    <input type="hidden" id="selected-product" name="selected-product" value="">

                    <div class="product-carousel-container">
                        <!-- Sol Ok -->
                        <button type="button" class="carousel-nav-btn prev" id="carousel-prev" aria-label="Önceki">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/>
                            </svg>
                        </button>

                        <!-- Sağ Ok -->
                        <button type="button" class="carousel-nav-btn next" id="carousel-next" aria-label="Sonraki">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M8.59 16.59L10 18l6-6-6-6-1.41 1.41L13.17 12z"/>
                            </svg>
                        </button>

                        <div class="product-cards-wrapper" id="product-cards-wrapper">
                            <div class="product-cards-grid" id="product-cards-grid">
                                <!-- Loading placeholder -->
                                <div class="products-loading" id="products-loading">
                                    <div class="spinner"></div>
                                    <div class="loading-text">Ürünler yükleniyor...</div>
                                </div>
                            </div>
                        </div>

                        <!-- Carousel Dots -->
                        <div class="carousel-dots" id="carousel-dots">
                            <!-- Dots JavaScript ile yüklenecek -->
                        </div>
                    </div>
                </div>

                <!-- Boş Durum - Ürün Seçilmediğinde -->
                <div class="barem-empty-state" id="barem-empty-state">
                    <div class="empty-icon">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                        </svg>
                    </div>
                    <h3>Baremli Fiyat Tanımlaması</h3>
                    <p>Baremli fiyatlarınızı görmek ve güncellemek için yukarıdan bir ürün seçiniz.</p>
                    <div class="arrow-hint">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z"/>
                        </svg>
                        Ürün seçmek için tıklayın
                    </div>
                </div>

                <!-- Barem İçeriği - Ürün Seçildiğinde -->
                <div class="barem-content" id="barem-content">
                    <div class="barem-section-title" id="barem-section">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M11.8 10.9c-2.27-.59-3-1.2-3-2.15 0-1.09 1.01-1.85 2.7-1.85 1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-1.94.42-3.5 1.68-3.5 3.61 0 2.31 1.91 3.46 4.7 4.13 2.5.6 3 1.48 3 2.41 0 .69-.49 1.79-2.7 1.79-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c1.95-.37 3.5-1.5 3.5-3.55 0-2.84-2.43-3.81-4.7-4.4z"/>
                        </svg>
                        <span id="barem-product-name"></span> - Barem Fiyatlarını Tanımlayın
                    </div>

                    <form id="baremli-fiyat-form" onsubmit="return saveBaremPrices(event)">
                    <div class="barem-table-container">
                        <table class="barem-table">
                            <thead>
                                <tr>
                                    <th style="width: 60px;">#</th>
                                    <th>Adet Aralığı</th>
                                    <th style="width: 180px;">Birim Fiyat (TL)</th>
                                    <th style="width: 100px;">İşlem</th>
                                </tr>
                            </thead>
                            <tbody id="barem-table-body">
                                <tr data-row="1">
                                    <td>1</td>
                                    <td>
                                        <div class="min-max-inputs">
                                            <input type="number" name="min_1" min="1" value="1" placeholder="Min" required>
                                            <span>-</span>
                                            <input type="number" name="max_1" min="1" value="10" placeholder="Max" required>
                                            <span>adet</span>
                                        </div>
                                    </td>
                                    <td>
                                        <input type="number" name="price_1" step="0.01" min="0" placeholder="0.00" required>
                                    </td>
                                    <td>
                                        <div class="barem-row-actions">
                                            <button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-row="2">
                                    <td>2</td>
                                    <td>
                                        <div class="min-max-inputs">
                                            <input type="number" name="min_2" min="1" value="11" placeholder="Min" required>
                                            <span>-</span>
                                            <input type="number" name="max_2" min="1" value="50" placeholder="Max" required>
                                            <span>adet</span>
                                        </div>
                                    </td>
                                    <td>
                                        <input type="number" name="price_2" step="0.01" min="0" placeholder="0.00" required>
                                    </td>
                                    <td>
                                        <div class="barem-row-actions">
                                            <button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <tr data-row="3">
                                    <td>3</td>
                                    <td>
                                        <div class="min-max-inputs">
                                            <input type="number" name="min_3" min="1" value="51" placeholder="Min" required>
                                            <span>-</span>
                                            <input type="number" name="max_3" min="1" value="100" placeholder="Max" required>
                                            <span>adet</span>
                                        </div>
                                    </td>
                                    <td>
                                        <input type="number" name="price_3" step="0.01" min="0" placeholder="0.00" required>
                                    </td>
                                    <td>
                                        <div class="barem-row-actions">
                                            <button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
                                                <svg viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                                                </svg>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <div class="add-barem-row">
                        <button type="button" class="btn-add-row" onclick="addBaremRow()">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                            </svg>
                            Yeni Barem Ekle
                        </button>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary" id="save-btn">
                            <svg class="icon-save" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            <svg class="icon-success" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                            </svg>
                            <svg class="icon-error" viewBox="0 0 24 24" fill="currentColor" style="display:none;">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                            <span class="btn-text">Kaydet</span>
                        </button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                            </svg>
                            Temizle
                        </button>
                    </div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <div class="ipragaz alert">
		<div class="alert-icon">
			<img src="" alt="">
		</div>
		<div class="alert-text"></div>
	</div>

	<div class="lds-css" style="display: none;">
		<div class="lds-dual-ring">
			<div></div>
		</div>
	</div>

	<form name="accessiblityForm">
		<input type="hidden" id="accesibility_refreshScreenReaderBufferField" name="accesibility_refreshScreenReaderBufferField" value="">
	</form>
	<div id="ariaStatusMsg" class="skip" role="status" aria-relevant="text" aria-live="polite"></div>

	<script>
    var ACC = {config: {}};
    ACC.config.contextPath = '/bayi';
    ACC.config.encodedContextPath = '/bayi/tr';
    ACC.config.CSRFToken = '7adbba15-455a-42c5-b21b-8325642828cb';
    ACC.config.siteName = 'İpragaz Bayi';

    ACC.messages = {
        "AddedToBasket": 'Sepete Eklendi',
        "Total": 'Toplam',
        "ValidationMessage": 'Hatalı giriş yaptınız.'
    };
    </script>

	<script src="./İpragaz Bayi_files/jquery-3.6.0.min.js"></script>
	<script src="./İpragaz Bayi_files/app.js"></script>
	<!-- Supabase -->
	<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
	<script src="./js/supabase-client.js"></script>
	<script src="./js/services/products-service.js"></script>
	<script src="./js/services/dealers-service.js"></script>
	<script src="./js/services/barem-prices-service.js"></script>
	<script src="./js/component-loader.js"></script>

	<script>
		// Auth kontrol - giris yapilmamissa login'e yonlendir
		if (!bayiAuthCheck()) {
			throw new Error('Auth required');
		}

		// Barem row counter
		let baremRowCount = 3;
		let selectedProductValue = '';

		// Dinamik veriler
		var products = [];
		var currentDealerId = null;
		var productBaremData = {}; // DB'den yüklenecek

		// Kaydet butonu durumlarını yönet
		function setSaveButtonState(state) {
			var btn = document.getElementById('save-btn');
			if (!btn) return;

			var textSpan = btn.querySelector('.btn-text');
			btn.classList.remove('success', 'error');

			if (state === 'success') {
				btn.classList.add('success');
				textSpan.textContent = 'Kaydedildi';
			} else if (state === 'error') {
				btn.classList.add('error');
				textSpan.textContent = 'Hata';
			} else {
				textSpan.textContent = 'Kaydet';
			}
		}

		// Form değişikliği algılama - butonu normale döndür
		function markFormAsChanged() {
			setSaveButtonState('normal');
		}

		// Ürün imaj URL'sini belirle
		function getProductImageUrl(product) {
			if (product.image_url) {
				return product.image_url;
			}
			var code = (product.code || '').toUpperCase();
			var name = (product.name || '').toLowerCase();

			if (code.includes('12') && (code.includes('UZUN') || name.includes('uzun'))) {
				return './İpragaz Bayi_files/IPR-BAYI-12-kg-ipr-uzun.png';
			}
			if (code.includes('12') && (code.includes('KISA') || name.includes('kısa') || name.includes('kisa'))) {
				return './İpragaz Bayi_files/IPR-BAYI-12-kg-ipr-uzun.png';
			}
			if (code.includes('IZOPRO') || code.includes('İZOPRO') || name.includes('izopro')) {
				return './İpragaz Bayi_files/IPR-BAYI-12kg-izo-pro.png';
			}
			if (code.includes('ISYERIM') || code.includes('İŞYERİM') || name.includes('işyerim') || name.includes('isyerim')) {
				return './İpragaz Bayi_files/IPR-BAYI-12-kg-ipr-uzun.png';
			}
			if (code.includes('45') || name.includes('45')) {
				return './İpragaz Bayi_files/IPR-BAYI-45kg-sanayi.png';
			}
			if (code.includes('24') || name.includes('24')) {
				return './İpragaz Bayi_files/IPR-BAYI-45kg-sanayi.png';
			}
			return './İpragaz Bayi_files/IPR-BAYI-12-kg-ipr-uzun.png';
		}

		// Ürünleri yükle
		async function loadProducts() {
			try {
				const { data, error } = await ProductsService.getAll();
				if (error) {
					console.error('Ürünler yüklenirken hata:', error);
					$('#product-cards-grid').html('<div class="products-loading"><div class="loading-text">Ürünler yüklenemedi</div></div>');
					return;
				}
				products = data || [];
				renderProductCards();
				initCarousel();
			} catch (err) {
				console.error('Ürünler yüklenirken hata:', err);
				$('#product-cards-grid').html('<div class="products-loading"><div class="loading-text">Ürünler yüklenemedi</div></div>');
			}
		}

		// Ürün kartlarını render et
		function renderProductCards() {
			var html = '';
			products.forEach(function(product) {
				var imageUrl = getProductImageUrl(product);
				var hasBarem = productBaremData[product.id] && productBaremData[product.id].length > 0;
				var weightKg = product.weight_kg || '';
				var isSelected = selectedProductValue === product.id;

				html += '<div class="product-card ' + (hasBarem ? '' : 'no-barem') + (isSelected ? ' selected' : '') + '" ' +
						'data-value="' + product.id + '" ' +
						'data-name="' + product.name + '" ' +
						'data-desc="' + (product.description || '') + '" ' +
						'onclick="selectProductCard(this)">' +
						'<div class="check-icon">' +
						'<svg viewBox="0 0 24 24" fill="currentColor">' +
						'<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>' +
						'</svg>' +
						'</div>' +
						(hasBarem ? '' : '<div class="barem-tooltip">Bu ürün grubu için henüz baremli fiyat tanımlamadınız.</div>') +
						'<div class="product-image">' +
						'<img src="' + imageUrl + '" alt="' + product.name + '">' +
						'</div>' +
						'<div class="product-name">' + product.name + '</div>' +
						'<div class="product-tag">' + weightKg + ' KG</div>' +
						'</div>';
			});
			$('#product-cards-grid').html(html);

			// Eğer seçili ürün varsa has-selection class'ını koru
			if (selectedProductValue) {
				document.querySelector('.product-cards-grid').classList.add('has-selection');
			}

			// Carousel dots
			var dotsHtml = '';
			products.forEach(function(p, i) {
				dotsHtml += '<button type="button" class="carousel-dot ' + (i === 0 ? 'active' : '') + '" data-index="' + i + '" aria-label="Ürün ' + (i + 1) + '"></button>';
			});
			$('#carousel-dots').html(dotsHtml);
		}

		// Barem verilerini yükle
		async function loadBaremData() {
			if (!currentDealerId) return;

			try {
				const { data, error } = await BaremPricesService.getByDealer(currentDealerId);
				if (error) {
					console.error('Barem verileri yüklenirken hata:', error);
					return;
				}

				productBaremData = {};
				if (data) {
					data.forEach(function(item) {
						if (!productBaremData[item.product_id]) {
							productBaremData[item.product_id] = [];
						}
						productBaremData[item.product_id].push({
							min: item.min_quantity,
							max: item.max_quantity,
							price: parseFloat(item.unit_price)
						});
					});

					// Her ürün için baremleri min değerine göre sırala
					Object.keys(productBaremData).forEach(function(productId) {
						productBaremData[productId].sort(function(a, b) { return a.min - b.min; });
					});
				}
			} catch (err) {
				console.error('Barem verileri yüklenirken hata:', err);
			}
		}

		// Ürünün baremi var mı kontrol et
		function hasBaremData(productValue) {
			const data = productBaremData[productValue];
			return data && data.length > 0;
		}

		// Sayfa yüklendiğinde çalıştır
		$(document).ready(async function() {
			// Bayi ID'sini al
			try {
				const { data: dealers } = await DealersService.getAll();
				if (dealers && dealers.length > 0) {
					currentDealerId = dealers[0].id;
				}
			} catch (err) {
				console.error('Bayi bilgisi alınamadı:', err);
			}

			// Önce barem verilerini yükle
			await loadBaremData();

			// Sonra ürünleri yükle
			await loadProducts();

			// Component'leri yükle
			ComponentLoader.loadBayiComponents();

			// Barem tablosundaki input değişikliklerini dinle
			$('#barem-table-body').on('input', 'input', function() {
				markFormAsChanged();
			});
		});

		// Barem tablosunu ürüne göre doldur
		function fillBaremTable(productValue) {
			const barems = productBaremData[productValue] || [];
			const tbody = document.getElementById('barem-table-body');
			tbody.innerHTML = '';

			// Eğer barem verisi varsa doldur
			if (barems && barems.length > 0) {
				barems.forEach((barem, index) => {
					const rowNum = index + 1;
					const row = document.createElement('tr');
					row.setAttribute('data-row', rowNum);
					row.innerHTML = `
						<td>${rowNum}</td>
						<td>
							<div class="min-max-inputs">
								<input type="number" name="min_${rowNum}" min="1" value="${barem.min}" placeholder="Min" required>
								<span>-</span>
								<input type="number" name="max_${rowNum}" min="1" value="${barem.max}" placeholder="Max" required>
								<span>adet</span>
							</div>
						</td>
						<td>
							<input type="number" name="price_${rowNum}" step="0.01" min="0" value="${barem.price.toFixed(2)}" placeholder="0.00" required>
						</td>
						<td>
							<div class="barem-row-actions">
								<button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
									<svg viewBox="0 0 24 24" fill="currentColor">
										<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
									</svg>
								</button>
							</div>
						</td>
					`;
					tbody.appendChild(row);
				});
				baremRowCount = barems.length;
			} else {
				// Barem yoksa varsayılan boş satır ekle
				const row = document.createElement('tr');
				row.setAttribute('data-row', 1);
				row.innerHTML = `
					<td>1</td>
					<td>
						<div class="min-max-inputs">
							<input type="number" name="min_1" min="1" value="1" placeholder="Min" required>
							<span>-</span>
							<input type="number" name="max_1" min="1" value="10" placeholder="Max" required>
							<span>adet</span>
						</div>
					</td>
					<td>
						<input type="number" name="price_1" step="0.01" min="0" placeholder="0.00" required>
					</td>
					<td>
						<div class="barem-row-actions">
							<button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
								<svg viewBox="0 0 24 24" fill="currentColor">
									<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
								</svg>
							</button>
						</div>
					</td>
				`;
				tbody.appendChild(row);
				baremRowCount = 1;
			}
		}

		// Select product card handler
		function selectProductCard(card) {
			// Remove selection from all cards
			document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));

			// Add selection to clicked card
			card.classList.add('selected');

			// Get product data
			const value = card.dataset.value;
			const name = card.dataset.name;

			// Update hidden input
			document.getElementById('selected-product').value = value;
			selectedProductValue = value;

			// Add has-selection class to grid (makes other cards look passive)
			document.querySelector('.product-cards-grid').classList.add('has-selection');

			// Update barem section title with product name
			document.getElementById('barem-product-name').textContent = name;

			// Barem tablosunu seçilen ürüne göre doldur
			fillBaremTable(value);

			// Boş durumu gizle, barem içeriğini göster
			document.getElementById('barem-empty-state').style.display = 'none';
			document.getElementById('barem-content').classList.add('active');

			// Butonu normale döndür (yeni ürün seçildi)
			setSaveButtonState('normal');

			// Smooth scroll to barem section
			setTimeout(() => {
				document.getElementById('barem-section').scrollIntoView({ behavior: 'smooth', block: 'start' });
			}, 300);
		}

		// Clear product selection
		function clearProductSelection() {
			document.querySelectorAll('.product-card').forEach(c => c.classList.remove('selected'));
			document.getElementById('selected-product').value = '';
			selectedProductValue = '';
			document.querySelector('.product-cards-grid').classList.remove('has-selection');

			// Barem içeriğini gizle, boş durumu göster
			document.getElementById('barem-content').classList.remove('active');
			document.getElementById('barem-empty-state').style.display = 'flex';
		}

		// Add new barem row
		function addBaremRow() {
			baremRowCount++;
			const tbody = document.getElementById('barem-table-body');
			const lastRow = tbody.querySelector('tr:last-child');
			let lastMax = 100;

			if (lastRow) {
				const lastMaxInput = lastRow.querySelector('input[name^="max_"]');
				if (lastMaxInput && lastMaxInput.value) {
					lastMax = parseInt(lastMaxInput.value);
				}
			}

			const newRow = document.createElement('tr');
			newRow.setAttribute('data-row', baremRowCount);
			newRow.innerHTML = `
				<td>${baremRowCount}</td>
				<td>
					<div class="min-max-inputs">
						<input type="number" name="min_${baremRowCount}" min="1" value="${lastMax + 1}" placeholder="Min" required>
						<span>-</span>
						<input type="number" name="max_${baremRowCount}" min="1" value="${lastMax + 50}" placeholder="Max" required>
						<span>adet</span>
					</div>
				</td>
				<td>
					<input type="number" name="price_${baremRowCount}" step="0.01" min="0" placeholder="0.00" required>
				</td>
				<td>
					<div class="barem-row-actions">
						<button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
							<svg viewBox="0 0 24 24" fill="currentColor">
								<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
							</svg>
						</button>
					</div>
				</td>
			`;
			tbody.appendChild(newRow);
			updateRowNumbers();

			// Butonu normale döndür (değişiklik yapıldı)
			markFormAsChanged();
		}

		// Delete barem row
		function deleteBaremRow(button) {
			const tbody = document.getElementById('barem-table-body');
			if (tbody.children.length > 1) {
				const row = button.closest('tr');
				row.remove();
				updateRowNumbers();
				// Butonu normale döndür (değişiklik yapıldı)
				markFormAsChanged();
			} else {
				alert('En az bir barem satırı olmalıdır.');
			}
		}

		// Update row numbers after delete
		function updateRowNumbers() {
			const rows = document.querySelectorAll('#barem-table-body tr');
			rows.forEach((row, index) => {
				row.querySelector('td:first-child').textContent = index + 1;
			});
		}

		// Reset form
		function resetForm() {
			document.getElementById('baremli-fiyat-form').reset();

			// Clear product card selection
			clearProductSelection();

			// Reset table to initial state
			const tbody = document.getElementById('barem-table-body');
			tbody.innerHTML = `
				<tr data-row="1">
					<td>1</td>
					<td>
						<div class="min-max-inputs">
							<input type="number" name="min_1" min="1" value="1" placeholder="Min" required>
							<span>-</span>
							<input type="number" name="max_1" min="1" value="10" placeholder="Max" required>
							<span>adet</span>
						</div>
					</td>
					<td>
						<input type="number" name="price_1" step="0.01" min="0" placeholder="0.00" required>
					</td>
					<td>
						<div class="barem-row-actions">
							<button type="button" class="btn-icon btn-delete" onclick="deleteBaremRow(this)" title="Sil">
								<svg viewBox="0 0 24 24" fill="currentColor">
									<path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
								</svg>
							</button>
						</div>
					</td>
				</tr>
			`;
			baremRowCount = 1;
		}

		// Pending barem data for confirmation
		let pendingBaremData = null;

		// Save barem prices - shows confirmation modal
		function saveBaremPrices(event) {
			event.preventDefault();

			// Check if product is selected using card-based selection
			if (!selectedProductValue) {
				alert('Lütfen bir ürün seçiniz.');
				return false;
			}

			const selectedCard = document.querySelector('.product-card.selected');
			const productName = selectedCard ? selectedCard.dataset.name : '';
			const productImage = selectedCard ? selectedCard.querySelector('img').src : '';
			const productTag = selectedCard ? selectedCard.querySelector('.product-tag').textContent : '';

			const baremData = {
				product: selectedProductValue,
				productName: productName,
				productImage: productImage,
				productTag: productTag,
				barems: []
			};

			const rows = document.querySelectorAll('#barem-table-body tr');
			let isValid = true;
			let prevMax = 0;
			let hasMinOne = false; // En az bir barem min=1 içermeli

			rows.forEach((row, index) => {
				if (!isValid) return; // Önceki hata varsa devam etme

				const minInput = row.querySelector('input[name^="min_"]');
				const maxInput = row.querySelector('input[name^="max_"]');
				const priceInput = row.querySelector('input[name^="price_"]');

				const min = parseInt(minInput.value);
				const max = parseInt(maxInput.value);
				const price = parseFloat(priceInput.value);

				// 0 ve negatif değer kontrolü
				if (isNaN(min) || min <= 0) {
					alert(`Satır ${index + 1}: Minimum adet 0 veya negatif olamaz.`);
					isValid = false;
					return;
				}

				if (isNaN(max) || max <= 0) {
					alert(`Satır ${index + 1}: Maksimum adet 0 veya negatif olamaz.`);
					isValid = false;
					return;
				}

				if (isNaN(price) || price <= 0) {
					alert(`Satır ${index + 1}: Fiyat 0 veya negatif olamaz.`);
					isValid = false;
					return;
				}

				// Validation
				if (min > max) {
					alert(`Satır ${index + 1}: Minimum değer maksimum değerden büyük olamaz.`);
					isValid = false;
					return;
				}

				if (index > 0 && min <= prevMax) {
					alert(`Satır ${index + 1}: Minimum değer önceki satırın maksimum değerinden büyük olmalıdır.`);
					isValid = false;
					return;
				}

				// min=1 kontrolü
				if (min === 1) {
					hasMinOne = true;
				}

				prevMax = max;

				baremData.barems.push({
					min: min,
					max: max,
					price: price
				});
			});

			if (!isValid) return false;

			// Tek ürün için barem kontrolü (min=1 olmalı)
			if (!hasMinOne) {
				alert('Tek ürün için mutlaka barem belirlemelisiniz. İlk baremin minimum değeri 1 olmalıdır.');
				return false;
			}

			// Store data and show confirmation modal
			pendingBaremData = baremData;
			showConfirmModal(baremData);

			return false;
		}

		// Show confirmation modal with barem data
		function showConfirmModal(data) {
			// Update product info
			document.getElementById('confirm-product-image').src = data.productImage;
			document.getElementById('confirm-product-name').textContent = data.productName;
			document.getElementById('confirm-product-tag').textContent = data.productTag;

			// Build barem list with clear labels
			let baremHtml = '';
			data.barems.forEach((barem, index) => {
				baremHtml += `
					<div class="confirm-barem-item">
						<div class="barem-number">${index + 1}</div>
						<div class="barem-range">
							<span class="barem-range-label">Adet Aralığı</span>
							<span class="barem-range-value">${barem.min} - ${barem.max} adet</span>
						</div>
						<div class="barem-price">
							<span class="barem-price-label">Birim Fiyat</span>
							<span class="barem-price-value">${barem.price.toFixed(2)} ₺</span>
						</div>
					</div>
				`;
			});
			document.getElementById('confirm-barem-list').innerHTML = baremHtml;

			// Show modal
			document.getElementById('confirm-modal-overlay').classList.add('active');
			document.body.style.overflow = 'hidden';
		}

		// Close confirmation modal
		function closeConfirmModal() {
			document.getElementById('confirm-modal-overlay').classList.remove('active');
			document.body.style.overflow = '';
			pendingBaremData = null;
		}

		// Confirm and save
		async function confirmSave() {
			if (!pendingBaremData) return;
			if (!currentDealerId) {
				setSaveButtonState('error');
				closeConfirmModal();
				return;
			}

			try {
				// Veritabanına kaydet
				const result = await BaremPricesService.save(
					currentDealerId,
					pendingBaremData.product,
					pendingBaremData.barems
				);

				if (result.error) {
					console.error('Kaydetme hatası:', result.error);
					setSaveButtonState('error');
					closeConfirmModal();
					return;
				}

				// Başarılı - barem verilerini yenile
				await loadBaremData();
				renderProductCards(); // no-barem class'ı güncellensin

				// Close modal
				closeConfirmModal();

				// Butonu başarılı duruma getir
				setSaveButtonState('success');
			} catch (err) {
				console.error('Kaydetme hatası:', err);
				setSaveButtonState('error');
				closeConfirmModal();
			}
		}

		// Product Carousel functionality
		function initCarousel() {
			var $wrapper = $('#product-cards-wrapper');
			var $prevBtn = $('#carousel-prev');
			var $nextBtn = $('#carousel-next');
			var $dotsContainer = $('#carousel-dots');
			var $dots = $('.carousel-dot');
			var $cards = $('.product-card');
			var cardCount = $cards.length;

			// Get card width including gap
			function getCardWidth() {
				var $card = $cards.first();
				if ($card.length === 0) return 180;
				return $card.outerWidth(true);
			}

			// Update dots based on scroll position
			function updateDots() {
				var scrollLeft = $wrapper.scrollLeft();
				var cardWidth = getCardWidth();
				var activeIndex = Math.round(scrollLeft / cardWidth);
				activeIndex = Math.min(activeIndex, cardCount - 1);
				activeIndex = Math.max(activeIndex, 0);

				$dots.removeClass('active');
				$dots.eq(activeIndex).addClass('active');
			}

			// Update arrow and dots states
			function updateArrows() {
				var scrollLeft = $wrapper.scrollLeft();
				var maxScroll = $wrapper[0].scrollWidth - $wrapper[0].clientWidth;

				// If no scroll needed (all cards fit), disable both arrows and dots
				if (maxScroll <= 0) {
					$prevBtn.prop('disabled', true);
					$nextBtn.prop('disabled', true);
					$dotsContainer.addClass('disabled');
				} else {
					$prevBtn.prop('disabled', scrollLeft <= 5);
					$nextBtn.prop('disabled', scrollLeft >= maxScroll - 5);
					$dotsContainer.removeClass('disabled');
				}
			}

			// Scroll to specific card
			function scrollToCard(index) {
				var cardWidth = getCardWidth();
				var targetScroll = index * cardWidth;
				$wrapper.animate({ scrollLeft: targetScroll }, 300);
			}

			// Previous button click
			$prevBtn.on('click', function() {
				var cardWidth = getCardWidth();
				var currentScroll = $wrapper.scrollLeft();
				$wrapper.animate({ scrollLeft: currentScroll - cardWidth }, 300);
			});

			// Next button click
			$nextBtn.on('click', function() {
				var cardWidth = getCardWidth();
				var currentScroll = $wrapper.scrollLeft();
				$wrapper.animate({ scrollLeft: currentScroll + cardWidth }, 300);
			});

			// Dot click
			$dots.on('click', function() {
				var maxScroll = $wrapper[0].scrollWidth - $wrapper[0].clientWidth;
				if (maxScroll <= 0) return; // No scroll needed

				var index = $(this).data('index');
				scrollToCard(index);
			});

			// Scroll event - update dots and arrows
			var scrollTimeout;
			$wrapper.on('scroll', function() {
				clearTimeout(scrollTimeout);
				scrollTimeout = setTimeout(function() {
					updateDots();
					updateArrows();
				}, 50);
			});

			// Initial state
			updateArrows();
			updateDots();

			// Update on window resize
			$(window).on('resize', function() {
				updateArrows();
				updateDots();
			});
		}

		// Page initialization
		$(document).ready(function() {
			// Initialize carousel
			initCarousel();

			// Bayi componentlerini yukle
			ComponentLoader.loadBayiComponents();

			// Close confirm modal on overlay click
			$('#confirm-modal-overlay').on('click', function(e) {
				if (e.target === this) {
					closeConfirmModal();
				}
			});
		});

	</script>

<!-- Mobile Sidebar Component -->
<div id="bayi-mobile-sidebar"></div>

<!-- Onay Modalı -->
<div class="confirm-modal-overlay" id="confirm-modal-overlay">
	<div class="confirm-modal">
		<div class="confirm-modal-header">
			<h3>Fiyatları Kaydetmeden Önce</h3>
			<p>Lütfen girdiğiniz bilgileri kontrol edin</p>
		</div>
		<div class="confirm-modal-product" id="confirm-modal-product">
			<img src="" alt="Ürün" id="confirm-product-image">
			<div class="product-info">
				<h4 id="confirm-product-name">Ürün Adı</h4>
				<span id="confirm-product-tag">12 KG</span>
			</div>
		</div>
		<div class="confirm-modal-barems">
			<h4>
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M3 13h2v-2H3v2zm0 4h2v-2H3v2zm0-8h2V7H3v2zm4 4h14v-2H7v2zm0 4h14v-2H7v2zM7 7v2h14V7H7z"/>
				</svg>
				Tanımlanan Barem Fiyatları
			</h4>
			<div class="confirm-barem-list" id="confirm-barem-list">
				<!-- Dinamik olarak doldurulacak -->
			</div>
		</div>
		<div class="confirm-modal-actions">
			<button type="button" class="btn btn-cancel" onclick="closeConfirmModal()">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
				</svg>
				Düzelt
			</button>
			<button type="button" class="btn btn-confirm" onclick="confirmSave()">
				<svg viewBox="0 0 24 24" fill="currentColor">
					<path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
				</svg>
				Evet, Kaydet
			</button>
		</div>
	</div>
</div>
</body></html>
